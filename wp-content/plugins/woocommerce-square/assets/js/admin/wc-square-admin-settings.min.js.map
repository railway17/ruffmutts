{"version":3,"sources":["wc-square-admin-settings.js"],"names":["jQuery","document","ready","$","pagenow","window","wc_square_admin_settings","is_sandbox","hide","next","closest","on","e","system_of_record","target","val","$inventory_sync","$inventory_sync_row","html","i18n","sync_inventory_label","find","sync_inventory_description","show","prop","trigger","preventDefault","WCBackboneModal","View","body","data","block","message","overlayCSS","opacity","onBlock","css","position","update_during_import","action","dispatch","sync_in_background","security","import_products_from_square","post","ajax_url","response","alert","location","reload","sync_products_with_square","success","unblock","noRecordsFoundRow","no_records_found","id","handle","handle_sync_with_square_records","console","log","recordId","currentTarget","rowId","remove","length","resolved","record","environment","is","append","type","name","value","getSyncStatus","job_id","$progress","get_sync_with_square_status_nonce","status","progress","skipped","parseInt","skipped_products_count","updated","updated_products_count","imported","imported_products_count","percentage","setTimeout","existing_sync_job_id","wallet_settings"],"mappings":"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","sourcesContent":["/* global wc_square_admin_settings */\n\n/**\n * WooCommerce Square scripts for admin product pages.\n *\n * @since 2.0.0\n */\njQuery( document ).ready( ( $ ) => {\n\tconst pagenow = window.pagenow || '';\n\n\t// bail if not on the admin settings page.\n\tif ( 'woocommerce_page_wc-settings' !== pagenow ) {\n\t\treturn;\n\t}\n\n\tif ( ! wc_square_admin_settings.is_sandbox ) {\n\t\t// Hide sandbox settings if is_sandbox is set.\n\t\t$( '#wc_square_sandbox_settings' ).hide();\n\t\t$( '#wc_square_sandbox_settings' ).next().hide();\n\t\t$( '.wc_square_sandbox_settings' ).closest( 'tr' ).hide();\n\t}\n\n\t$( '#wc_square_system_of_record' ).on( 'change', ( e ) => {\n\t\tconst system_of_record = $( e.target ).val();\n\t\tconst $inventory_sync = $( '#wc_square_enable_inventory_sync' );\n\t\tconst $inventory_sync_row = $inventory_sync.closest( 'tr' );\n\n\t\t// toggle the \"Sync inventory\" setting depending on the SOR.\n\t\tif ( 'square' === system_of_record || 'woocommerce' === system_of_record ) {\n\t\t\t$inventory_sync.next( 'span' ).html( wc_square_admin_settings.i18n.sync_inventory_label[ system_of_record ] );\n\t\t\t$inventory_sync_row.find( '.description' ).html( wc_square_admin_settings.i18n.sync_inventory_description[ system_of_record ] );\n\t\t\t$inventory_sync_row.show();\n\t\t} else {\n\t\t\t$inventory_sync.prop( 'checked', false );\n\t\t\t$inventory_sync_row.hide();\n\t\t}\n\n\t\t// toggle the \"Hide missing products\" setting depending on the SOR.\n\t\tif ( 'square' === system_of_record ) {\n\t\t\t$( '#wc_square_hide_missing_products' ).closest( 'tr' ).show();\n\t\t} else {\n\t\t\t$( '#wc_square_hide_missing_products' ).closest( 'tr' ).hide();\n\t\t}\n\t} ).trigger( 'change' );\n\n\t$( '.js-import-square-products' ).on( 'click', ( e ) => {\n\t\te.preventDefault();\n\n\t\tnew $.WCBackboneModal.View( {\n\t\t\ttarget: 'wc-square-import-products',\n\t\t} );\n\n\t\t$( '#btn-close' ).on( 'click', ( e ) => {\n\t\t\te.preventDefault();\n\n\t\t\t$( 'button.modal-close' ).trigger( 'click' );\n\t\t} );\n\t} );\n\n\t// initiate a manual sync.\n\t$( '#wc-square-sync' ).on( 'click', ( e ) => {\n\t\te.preventDefault();\n\n\t\t// open a modal dialog.\n\t\tnew $.WCBackboneModal.View( {\n\t\t\ttarget: 'wc-square-sync',\n\t\t} );\n\n\t\t// enable cancel sync button.\n\t\t$( '#btn-close' ).on( 'click', ( e ) => {\n\t\t\te.preventDefault();\n\n\t\t\t$( 'button.modal-close' ).trigger( 'click' );\n\t\t} );\n\t} );\n\n\t// Listen for wc_backbone_modal_response event handler.\n\t$( document.body ).on( 'wc_backbone_modal_response', ( e, target ) => {\n\t\tlet data;\n\n\t\tswitch ( target ) {\n\t\t\tcase 'wc-square-import-products':\n\t\t\t\t// Add Block overlay since the modal exits immediately\n\t\t\t\t// after wc_backbone_modal_response is triggered.\n\t\t\t\t$( '#wpbody' ).block( {\n\t\t\t\t\tmessage: null,\n\t\t\t\t\toverlayCSS: {\n\t\t\t\t\t\topacity: '0.2',\n\t\t\t\t\t},\n\t\t\t\t\tonBlock: function onBlock() {\n\t\t\t\t\t\t$( '.blockUI.blockOverlay' ).css(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tposition: 'fixed',\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t} );\n\n\t\t\t\tconst update_during_import = $( '#wc-square-import-product-updates' ).prop( 'checked' );\n\t\t\t\tdata = {\n\t\t\t\t\taction: 'wc_square_import_products_from_square',\n\t\t\t\t\tdispatch: wc_square_admin_settings.sync_in_background,\n\t\t\t\t\tsecurity: wc_square_admin_settings.import_products_from_square,\n\t\t\t\t\tupdate_during_import,\n\t\t\t\t};\n\n\t\t\t\t$.post( wc_square_admin_settings.ajax_url, data, ( response ) => {\n\t\t\t\t\tconst message = response.data ? response.data : null;\n\n\t\t\t\t\tif ( message ) {\n\t\t\t\t\t\talert( message );\n\t\t\t\t\t}\n\n\t\t\t\t\tlocation.reload();\n\t\t\t\t} );\n\t\t\t\tbreak;\n\n\t\t\tcase 'wc-square-sync':\n\t\t\t\t$( 'table.sync' ).block( {\n\t\t\t\t\tmessage: null,\n\t\t\t\t\toverlayCSS: {\n\t\t\t\t\t\topacity: '0.2',\n\t\t\t\t\t},\n\t\t\t\t} );\n\n\t\t\t\t$( 'table.records' ).block( {\n\t\t\t\t\tmessage: null,\n\t\t\t\t\toverlayCSS: {\n\t\t\t\t\t\topacity: '0.2',\n\t\t\t\t\t},\n\t\t\t\t} );\n\n\t\t\t\t$( '#wc-square_clear-sync-records' ).prop( 'disabled', true );\n\n\t\t\t\tdata = {\n\t\t\t\t\taction: 'wc_square_sync_products_with_square',\n\t\t\t\t\tdispatch: wc_square_admin_settings.sync_in_background,\n\t\t\t\t\tsecurity: wc_square_admin_settings.sync_products_with_square,\n\t\t\t\t};\n\n\t\t\t\t$.post( wc_square_admin_settings.ajax_url, data, ( response ) => {\n\t\t\t\t\tif ( response && response.success ) {\n\t\t\t\t\t\tlocation.reload();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$( '#wc-square_clear-sync-records' ).prop( 'disabled', false );\n\t\t\t\t\t\t$( 'table.sync' ).unblock();\n\t\t\t\t\t\t$( 'table.records' ).unblock();\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t}\n\t} );\n\n\t// Clear sync records history.\n\tconst noRecordsFoundRow = '<tr><td colspan=\"4\"><em>' + wc_square_admin_settings.i18n.no_records_found + '</em></td></tr>';\n\t$( '#wc-square_clear-sync-records' ).on( 'click', ( e ) => {\n\t\te.preventDefault();\n\n\t\t$( 'table.records' ).block( {\n\t\t\tmessage: null,\n\t\t\toverlayCSS: {\n\t\t\t\topacity: '0.2',\n\t\t\t},\n\t\t} );\n\n\t\tconst data = {\n\t\t\taction: 'wc_square_handle_sync_records',\n\t\t\tid: 'all',\n\t\t\thandle: 'delete',\n\t\t\tsecurity: wc_square_admin_settings.handle_sync_with_square_records,\n\t\t};\n\n\t\t$.post( wc_square_admin_settings.ajax_url, data, ( response ) => {\n\t\t\tif ( response && response.success ) {\n\t\t\t\t$( 'table.records tbody' ).html( noRecordsFoundRow );\n\t\t\t\t$( '#wc-square_clear-sync-records' ).prop( 'disabled', true );\n\t\t\t} else {\n\t\t\t\tif ( response.data ) {\n\t\t\t\t\talert( response.data );\n\t\t\t\t}\n\t\t\t\tconsole.log( response );\n\t\t\t}\n\t\t\t$( 'table.records' ).unblock();\n\t\t} );\n\t} );\n\n\t// Individual sync records actions.\n\t$( '.records .actions button.action' ).on( 'click', ( e ) => {\n\t\te.preventDefault();\n\n\t\t$( 'table.records' ).block( {\n\t\t\tmessage: null,\n\t\t\toverlayCSS: {\n\t\t\t\topacity: '0.2',\n\t\t\t},\n\t\t} );\n\t\tconst recordId = $( e.currentTarget ).data( 'id' );\n\t\tconst action = $( e.currentTarget ).data( 'action' );\n\t\tconst data = {\n\t\t\taction: 'wc_square_handle_sync_records',\n\t\t\tid: recordId,\n\t\t\thandle: action,\n\t\t\tsecurity: wc_square_admin_settings.handle_sync_with_square_records,\n\t\t};\n\n\t\t$.post( wc_square_admin_settings.ajax_url, data, ( response ) => {\n\t\t\tif ( response && response.success ) {\n\t\t\t\tconst rowId = '#record-' + recordId;\n\n\t\t\t\tif ( 'delete' === action ) {\n\t\t\t\t\t$( rowId ).remove();\n\n\t\t\t\t\tif ( ! $( 'table.records tbody tr' ).length ) {\n\t\t\t\t\t\t$( 'table.records tbody' ).html( noRecordsFoundRow );\n\t\t\t\t\t\t$( '#wc-square_clear-sync-records' ).prop( 'disabled', true );\n\t\t\t\t\t}\n\t\t\t\t} else if ( 'resolve' === action || 'unsync' === action ) {\n\t\t\t\t\t$( rowId + ' .type' ).html( '<mark class=\"resolved\"><span>' + wc_square_admin_settings.i18n.resolved + '</span></mark>' );\n\t\t\t\t\t$( rowId + ' .actions' ).html( '&mdash;' );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ( response && response.data ) {\n\t\t\t\t\talert( response.data );\n\t\t\t\t}\n\n\t\t\t\tconsole.log( {\n\t\t\t\t\trecord: recordId,\n\t\t\t\t\taction,\n\t\t\t\t\tresponse,\n\t\t\t\t} );\n\t\t\t}\n\t\t\t$( 'table.records' ).unblock();\n\t\t} );\n\t} );\n\n\t// Add explicit square environment to post data to deal with swapping between production and sandbox in the back end.\n\t$( 'form' ).on( 'submit', ( e ) => {\n\t\tconst environment = $( '#wc_square_enable_sandbox' ).is( ':checked' ) ? 'sandbox' : 'production';\n\n\t\t$( e.target ).append(\n\t\t\t$( '<input>',\n\t\t\t\t{\n\t\t\t\t\ttype: 'hidden',\n\t\t\t\t\tname: 'wc_square_environment',\n\t\t\t\t\tvalue: environment,\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\t} );\n\n\t/**\n\t * Returns a job sync status.\n\t *\n\t * @since 2.0.0\n\t *\n\t * @param {string} job_id\n\t */\n\tconst getSyncStatus = ( job_id ) => {\n\t\tlet $progress = $( 'span.progress' );\n\n\t\tif ( ! $progress || 0 === $progress.length ) {\n\t\t\t$( 'p.sync-result' ).append( ' <span class=\"progress\" style=\"display:block\"></span>' );\n\t\t\t$progress = $( 'span.progress' );\n\t\t}\n\n\t\tconst data = {\n\t\t\taction: 'wc_square_get_sync_with_square_status',\n\t\t\tsecurity: wc_square_admin_settings.get_sync_with_square_status_nonce,\n\t\t\tjob_id,\n\t\t};\n\n\t\t$.post( wc_square_admin_settings.ajax_url, data, ( response ) => {\n\t\t\tif ( response && response.data ) {\n\t\t\t\tif ( response.success && response.data.id ) {\n\t\t\t\t\t// start the progress spinner.\n\t\t\t\t\t$( 'table.sync .spinner' ).css( 'visibility', 'visible' );\n\t\t\t\t\t// disable interacting with records as more could be added during a sync process.\n\t\t\t\t\t$( '#wc-square_clear-sync-records' ).prop( 'disabled', true );\n\t\t\t\t\t$( 'table.records .actions button' ).prop( 'disabled', true );\n\t\t\t\t\t// continue if the job is in progression.\n\t\t\t\t\tif ( 'completed' !== response.data.status && 'failed' !== response.data.status ) {\n\t\t\t\t\t\tlet progress = ' ';\n\t\t\t\t\t\t// update progress info in table cell.\n\t\t\t\t\t\tif ( 'product_import' === response.data.action ) {\n\t\t\t\t\t\t\tprogress += wc_square_admin_settings.i18n.skipped + ': ' + parseInt( response.data.skipped_products_count, 10 ) + '<br/>';\n\t\t\t\t\t\t\tprogress += wc_square_admin_settings.i18n.updated + ': ' + parseInt( response.data.updated_products_count, 10 ) + '<br/>';\n\t\t\t\t\t\t\tprogress += wc_square_admin_settings.i18n.imported + ': ' + parseInt( response.data.imported_products_count, 10 );\n\t\t\t\t\t\t} else if ( response.data.percentage ) {\n\t\t\t\t\t\t\tprogress += parseInt( response.data.percentage, 10 ) + '%';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$progress.html( progress );\n\n\t\t\t\t\t\t// recursion update loop until we're 'completed' (add a long timeout to avoid missing callback return output).\n\t\t\t\t\t\tsetTimeout( () => {\n\t\t\t\t\t\t\tgetSyncStatus( response.data.id );\n\t\t\t\t\t\t}, 30 * 1000 );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// reload page, display updated sync dates and any sync records messages.\n\t\t\t\t\t\tlocation.reload(); // unlikely job processing exception.\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t$( '#wc-square_clear-sync-records' ).prop( 'disabled', false );\n\t\t\t\t\t$( 'table.records .actions button' ).prop( 'disabled', false );\n\t\t\t\t\t$( 'table.sync .spinner' ).css( 'visibility', 'hidden' );\n\t\t\t\t\tconsole.log( response );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t};\n\n\t// run once on page load.\n\tif ( wc_square_admin_settings.existing_sync_job_id ) {\n\t\tgetSyncStatus( wc_square_admin_settings.existing_sync_job_id );\n\t}\n\n\t// Show/hide Digital Wallet Settings on Square gateway settings page.\n\t$( '#woocommerce_square_credit_card_enable_digital_wallets' ).on( 'change', () => {\n\t\tconst wallet_settings = $( '.wc-square-digital-wallet-options' );\n\n\t\tif ( $( '#woocommerce_square_credit_card_enable_digital_wallets' ).is( ':checked' ) ) {\n\t\t\twallet_settings.closest( 'tr' ).show();\n\t\t} else {\n\t\t\twallet_settings.closest( 'tr' ).hide();\n\t\t}\n\t} ).trigger( 'change' );\n} );\n"],"file":"wc-square-admin-settings.min.js"}