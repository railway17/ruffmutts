{"version":3,"sources":["wc-square.js"],"names":["jQuery","document","ready","$","WC_Square_Payment_Form_Handler","args","id","id_dasherized","csc_required","enabled_card_types","square_card_types","ajax_log_nonce","ajax_url","application_id","currency_code","general_error","input_styles","is_3ds_enabled","is_3d_secure_enabled","is_add_payment_method_page","is_checkout_registration_enabled","is_user_logged_in","location_id","logging_enabled","ajax_wc_checkout_validate_nonce","is_manual_order_payment","length","form","handle_checkout_page","handle_pay_page","handle_add_payment_method_page","log","params","window","sv_wc_payment_gateway_payment_form_params","body","on","val","payment_form","recalculateSize","set_payment_fields","handle_saved_payment_methods","validate_payment_data","form_handler","$new_payment_method_selection","tokenized_payment_method_selected","slideUp","slideDown","trigger","e","target","is","show_save_payment_checkbox","hide_save_payment_checkbox","self","Object","entries","form_fields","_","field","attr","replaceWith","handle_form_loaded","destroy","SqPaymentForm","get_form_params","build","card_number","expiration","csc","postal_code","applicationId","locationId","cardNumber","elementId","placeholder","data","expirationDate","cvv","postalCode","inputClass","inputStyles","callbacks","inputEventReceived","handle_input_event","cardNonceResponseReceived","errors","nonce","cardData","handle_card_nonce_response","unsupportedBrowserDetected","handle_unsupported_browser","paymentFormLoaded","setPostalCode","addClass","$input","eventType","handle_card_brand_change","cardBrand","brand","i","c","replace","card_class","includes","has_nonce","tokenized_card_id","get_tokenized_payment_method_id","has_verification_token","block_ui","verifyBuyer","get_verification_details","handle_verify_buyer_response","bind","requestCardNonce","find","handle_errors","message","log_data","last_4","exp_month","exp_year","billing_postal_code","verification_result","each","index","error","token","verification_details","billingContact","familyName","givenName","email","country","region","city","phone","addressLines","intent","get_intent","amount","get_amount","currencyCode","$save_method_input","save_payment_method","messages","field_order","sort","a","b","indexOf","type","push","render_checkout_errors","render_errors","unblock_ui","remove","prepend","join","removeClass","unblock","animate","scrollTop","offset","top","block","overlayCSS","background","opacity","$parent_row","closest","hide","next","show","ajax_data","action","security","ajax","url","console","square_errors","wc_cart_fragments_params","wc_ajax_url","toString","square_handler","form_data","serializeArray","name","value","method","cache","complete","response","result","responseJSON","hasOwnProperty","map","children","text","trim","unshift","success"],"mappings":"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","sourcesContent":["/* global wc_cart_fragments_params */\n\n/**\n * WooCommerce Square Payment Form handler.\n *\n * @since 2.0.0\n */\njQuery( document ).ready( ( $ ) => {\n\t/**\n\t * Square Credit Card Payment Form Handler class.\n\t *\n\t * @since 2.0.0\n\t */\n\tclass WC_Square_Payment_Form_Handler {\n\t\t/**\n\t\t * Setup handler.\n\t\t *\n\t\t * @since 2.3.2-1\n\t\t *\n\t\t * @param {Object} args\n\t\t */\n\t\tconstructor( args ) {\n\t\t\tthis.id = args.id;\n\t\t\tthis.id_dasherized = args.id_dasherized;\n\t\t\tthis.csc_required = args.csc_required;\n\t\t\tthis.enabled_card_types = args.enabled_card_types;\n\t\t\tthis.square_card_types = args.square_card_types;\n\t\t\tthis.ajax_log_nonce = args.ajax_log_nonce;\n\t\t\tthis.ajax_url = args.ajax_url;\n\t\t\tthis.application_id = args.application_id;\n\t\t\tthis.currency_code = args.currency_code;\n\t\t\tthis.general_error = args.general_error;\n\t\t\tthis.input_styles = args.input_styles;\n\t\t\tthis.is_3ds_enabled = args.is_3d_secure_enabled;\n\t\t\tthis.is_add_payment_method_page = args.is_add_payment_method_page;\n\t\t\tthis.is_checkout_registration_enabled = args.is_checkout_registration_enabled;\n\t\t\tthis.is_user_logged_in = args.is_user_logged_in;\n\t\t\tthis.location_id = args.location_id;\n\t\t\tthis.logging_enabled = args.logging_enabled;\n\t\t\tthis.ajax_wc_checkout_validate_nonce = args.ajax_wc_checkout_validate_nonce;\n\t\t\tthis.is_manual_order_payment = args.is_manual_order_payment;\n\n\t\t\tif ( $( 'form.checkout' ).length ) {\n\t\t\t\tthis.form = $( 'form.checkout' );\n\t\t\t\tthis.handle_checkout_page();\n\t\t\t} else if ( $( 'form#order_review' ).length ) {\n\t\t\t\tthis.form = $( 'form#order_review' );\n\t\t\t\tthis.handle_pay_page();\n\t\t\t} else if ( $( 'form#add_payment_method' ).length ) {\n\t\t\t\tthis.form = $( 'form#add_payment_method' );\n\t\t\t\tthis.handle_add_payment_method_page();\n\t\t\t} else {\n\t\t\t\tthis.log( 'No payment form found!' );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// localized error messages.\n\t\t\tthis.params = window.sv_wc_payment_gateway_payment_form_params;\n\n\t\t\t// unblock the UI and clear any payment nonces when a server-side error occurs.\n\t\t\t$( document.body ).on( 'checkout_error', () => {\n\t\t\t\t$( 'input[name=wc-square-credit-card-payment-nonce]' ).val( '' );\n\t\t\t\t$( 'input[name=wc-square-credit-card-buyer-verification-token]' ).val( '' );\n\t\t\t} );\n\n\t\t\t$( document.body ).on( 'click', `#payment_method_${ this.id }`, () => {\n\t\t\t\tif ( this.payment_form ) {\n\t\t\t\t\tthis.log( 'Recalculating payment form size' );\n\t\t\t\t\tthis.payment_form.recalculateSize();\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\t/**\n\t\t * Public: Handle required actions on the checkout page.\n\t\t */\n\t\thandle_checkout_page() {\n\t\t\t// updated payment fields jQuery object on each checkout update (prevents stale data).\n\t\t\t$( document.body ).on( 'updated_checkout', () => this.set_payment_fields() );\n\n\t\t\t// handle saved payment methods note on the checkout page.\n\t\t\t// this is bound to `updated_checkout` so it fires even when other parts of the checkout are changed.\n\t\t\t$( document.body ).on( 'updated_checkout', () => this.handle_saved_payment_methods() );\n\n\t\t\t// validate payment data before order is submitted.\n\t\t\tthis.form.on( `checkout_place_order_${ this.id }`, () => this.validate_payment_data() );\n\t\t}\n\n\t\t/**\n\t\t * Public: Handle associated actions for saved payment methods.\n\t\t */\n\t\thandle_saved_payment_methods() {\n\t\t\t// make available inside change events.\n\t\t\tconst id_dasherized = this.id_dasherized;\n\t\t\tconst form_handler = this;\n\t\t\tconst $new_payment_method_selection = $( `div.js-wc-${ id_dasherized }-new-payment-method-form` );\n\n\t\t\t// show/hide the saved payment methods when a saved payment method is de-selected/selected.\n\t\t\t$( `input.js-wc-${ this.id_dasherized }-payment-token` ).on( 'change', () => {\n\t\t\t\tconst tokenized_payment_method_selected = $( `input.js-wc-${ id_dasherized }-payment-token:checked` ).val();\n\n\t\t\t\tif ( tokenized_payment_method_selected ) {\n\t\t\t\t\t// using an existing tokenized payment method, hide the 'new method' fields.\n\t\t\t\t\t$new_payment_method_selection.slideUp( 200 );\n\t\t\t\t} else {\n\t\t\t\t\t// use new payment method, display the 'new method' fields.\n\t\t\t\t\t$new_payment_method_selection.slideDown( 200 );\n\t\t\t\t}\n\t\t\t} ).trigger( 'change' );\n\n\t\t\t// display the 'save payment method' option for guest checkouts if the 'create account' option is checked\n\t\t\t// but only hide the input if there is a 'create account' checkbox (some themes just display the password).\n\t\t\t$( 'input#createaccount' ).on( 'change', ( e ) => {\n\t\t\t\tif ( $( e.target ).is( ':checked' ) ) {\n\t\t\t\t\tform_handler.show_save_payment_checkbox( id_dasherized );\n\t\t\t\t} else {\n\t\t\t\t\tform_handler.hide_save_payment_checkbox( id_dasherized );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\tif ( ! $( 'input#createaccount' ).is( ':checked' ) ) {\n\t\t\t\t$( 'input#createaccount' ).trigger( 'change' );\n\t\t\t}\n\n\t\t\t// hide the 'save payment method' when account creation is not enabled and customer is not logged in.\n\t\t\tif ( ! this.is_user_logged_in && ! this.is_checkout_registration_enabled ) {\n\t\t\t\tthis.hide_save_payment_checkbox( id_dasherized );\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Public: Handle required actions on the Order > Pay page.\n\t\t */\n\t\thandle_pay_page() {\n\t\t\tthis.set_payment_fields();\n\n\t\t\t// handle saved payment methods.\n\t\t\tthis.handle_saved_payment_methods();\n\n\t\t\tconst self = this;\n\n\t\t\t// validate payment data before order is submitted.\n\t\t\t// but only when one of our payment gateways is selected.\n\t\t\tthis.form.on( 'submit', function() {\n\t\t\t\tif ( $( '#order_review input[name=payment_method]:checked' ).val() === self.id ) {\n\t\t\t\t\treturn self.validate_payment_data();\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\t/**\n\t\t * Public: Handle required actions on the Add Payment Method page.\n\t\t */\n\t\thandle_add_payment_method_page() {\n\t\t\tthis.set_payment_fields();\n\n\t\t\tconst self = this;\n\n\t\t\t// validate payment data before order is submitted.\n\t\t\t// but only when one of our payment gateways is selected.\n\t\t\tthis.form.on( 'submit', function() {\n\t\t\t\tif ( $( '#add_payment_method input[name=payment_method]:checked' ).val() === self.id ) {\n\t\t\t\t\treturn self.validate_payment_data();\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\t/**\n\t\t * Sets up the Square payment fields.\n\t\t *\n\t\t * @since 2.0.0\n\t\t */\n\t\tset_payment_fields() {\n\t\t\tif ( ! $( `#wc-${ this.id_dasherized }-account-number-hosted` ).length ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( $( `#wc-${ this.id_dasherized }-account-number-hosted` ).is( 'iframe' ) ) {\n\t\t\t\tthis.log( 'Re-adding payment form' );\n\n\t\t\t\tfor ( const [ _, field ] of Object.entries( this.form_fields ) ) { // eslint-disable-line no-unused-vars\n\t\t\t\t\t$( field.attr( 'id' ) ).replaceWith( field );\n\t\t\t\t}\n\n\t\t\t\tthis.handle_form_loaded();\n\t\t\t} else {\n\t\t\t\tif ( this.payment_form ) {\n\t\t\t\t\tthis.log( 'Destroying payment form' );\n\t\t\t\t\tthis.payment_form.destroy();\n\t\t\t\t\tthis.payment_form = null;\n\t\t\t\t}\n\n\t\t\t\tthis.log( 'Building payment form' );\n\n\t\t\t\tthis.payment_form = new SqPaymentForm( this.get_form_params() ); // eslint-disable-line no-undef\n\n\t\t\t\tthis.payment_form.build();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Gets the Square payment form params.\n\t\t *\n\t\t * @since 2.0.0\n\t\t *\n\t\t * @return {Object} Form params.\n\t\t */\n\t\tget_form_params() {\n\t\t\tthis.form_fields = {\n\t\t\t\tcard_number: $( `#wc-${ this.id_dasherized }-account-number-hosted` ),\n\t\t\t\texpiration: $( `#wc-${ this.id_dasherized }-expiry-hosted` ),\n\t\t\t\tcsc: $( `#wc-${ this.id_dasherized }-csc-hosted` ),\n\t\t\t\tpostal_code: $( `#wc-${ this.id_dasherized }-postal-code-hosted` ),\n\t\t\t};\n\n\t\t\treturn {\n\t\t\t\tapplicationId: this.application_id,\n\t\t\t\tlocationId: this.location_id,\n\t\t\t\tcardNumber: {\n\t\t\t\t\telementId: this.form_fields.card_number.attr( 'id' ),\n\t\t\t\t\tplaceholder: this.form_fields.card_number.data( 'placeholder' ),\n\t\t\t\t},\n\t\t\t\texpirationDate: {\n\t\t\t\t\telementId: this.form_fields.expiration.attr( 'id' ),\n\t\t\t\t\tplaceholder: this.form_fields.expiration.data( 'placeholder' ),\n\t\t\t\t},\n\t\t\t\tcvv: {\n\t\t\t\t\telementId: this.form_fields.csc.attr( 'id' ),\n\t\t\t\t\tplaceholder: this.form_fields.csc.data( 'placeholder' ),\n\t\t\t\t},\n\t\t\t\tpostalCode: {\n\t\t\t\t\telementId: this.form_fields.postal_code.attr( 'id' ),\n\t\t\t\t\tplaceholder: this.form_fields.postal_code.data( 'placeholder' ),\n\t\t\t\t},\n\t\t\t\tinputClass: `wc-${ this.id_dasherized }-payment-field`,\n\t\t\t\tinputStyles: this.input_styles,\n\t\t\t\tcallbacks: {\n\t\t\t\t\tinputEventReceived: ( e ) => this.handle_input_event( e ),\n\t\t\t\t\tcardNonceResponseReceived: ( errors, nonce, cardData ) => this.handle_card_nonce_response( errors, nonce, cardData ),\n\t\t\t\t\tunsupportedBrowserDetected: () => this.handle_unsupported_browser(),\n\t\t\t\t\tpaymentFormLoaded: () => this.handle_form_loaded(),\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Handles when the payment form is fully loaded.\n\t\t *\n\t\t * @since 2.0.0\n\t\t */\n\t\thandle_form_loaded() {\n\t\t\tthis.log( 'Payment form loaded' );\n\n\t\t\tthis.payment_form.setPostalCode( $( '#billing_postcode' ).val() );\n\n\t\t\t// hide the postcode field on the checkout page or if it already has a value.\n\t\t\tif ( $( 'form.checkout' ).length || $( '#billing_postcode' ).val() ) {\n\t\t\t\t$( '.wc-square-credit-card-card-postal-code-parent' ).addClass( 'hidden' );\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Handles payment form input changes.\n\t\t *\n\t\t * @since 2.0.0\n\t\t *\n\t\t * @param {Object} e\n\t\t */\n\t\thandle_input_event( e ) {\n\t\t\tconst $input = $( '#' + e.elementId );\n\n\t\t\tif ( e.eventType === 'cardBrandChanged' ) {\n\t\t\t\tthis.handle_card_brand_change( e.cardBrand, $input );\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Handles card number brand changes.\n\t\t *\n\t\t * @since 2.0.0\n\t\t *\n\t\t * @param {string} brand\n\t\t * @param {Object} $input\n\t\t */\n\t\thandle_card_brand_change( brand, $input ) {\n\t\t\tthis.log( `Card brand changed to ${ brand }` );\n\n\t\t\t// clear any existing card type class\n\t\t\t$input.attr( 'class', ( i, c ) => {\n\t\t\t\treturn c.replace( /(^|\\s)card-type-\\S+/g, '' );\n\t\t\t} );\n\n\t\t\tlet card_class = 'plain';\n\n\t\t\tif ( null === brand || 'unknown' === brand ) {\n\t\t\t\tbrand = '';\n\t\t\t}\n\n\t\t\tif ( null !== this.square_card_types[ brand ] ) {\n\t\t\t\tbrand = this.square_card_types[ brand ];\n\t\t\t}\n\n\t\t\tif ( brand && ! this.enabled_card_types.includes( brand ) ) {\n\t\t\t\tcard_class = 'invalid';\n\t\t\t} else {\n\t\t\t\tcard_class = brand;\n\t\t\t}\n\n\t\t\t$( `input[name=wc-${ this.id_dasherized }-card-type]` ).val( brand );\n\n\t\t\t$input.addClass( `card-type-${ card_class }` );\n\t\t}\n\n\t\t/**\n\t\t * Used to request a card nonce and submit the form.\n\t\t *\n\t\t * @since 2.0.0\n\t\t */\n\t\tvalidate_payment_data() {\n\t\t\tif ( this.form.is( '.processing' ) ) {\n\t\t\t\t// bail when already processing.\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// let through if nonce is already present - nonce is only present on non-tokenized payments.\n\t\t\tif ( this.has_nonce() ) {\n\t\t\t\tthis.log( 'Payment nonce present, placing order' );\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst tokenized_card_id = this.get_tokenized_payment_method_id();\n\n\t\t\tif ( tokenized_card_id ) {\n\t\t\t\tif ( ! this.is_3ds_enabled ) {\n\t\t\t\t\t// if 3DS is disabled and paying with a saved method, no further validation needed.\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif ( this.has_verification_token() ) {\n\t\t\t\t\tthis.log( 'Tokenized payment verification token present, placing order' );\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tthis.log( 'Requesting verification token for tokenized payment' );\n\n\t\t\t\tthis.block_ui();\n\t\t\t\tthis.payment_form.verifyBuyer( tokenized_card_id, this.get_verification_details(), this.handle_verify_buyer_response.bind( this ) );\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.log( 'Requesting payment nonce' );\n\t\t\tthis.block_ui();\n\t\t\tthis.payment_form.requestCardNonce();\n\t\t\treturn false;\n\t\t}\n\n\t\t/**\n\t\t * Gets the selected tokenized payment method ID, if there is one.\n\t\t *\n\t\t * @since 2.1.0\n\t\t *\n\t\t * @return {string} Tokenized payment method ID.\n\t\t */\n\t\tget_tokenized_payment_method_id() {\n\t\t\treturn $( `.payment_method_${ this.id }` ).find( '.js-wc-square-credit-card-payment-token:checked' ).val();\n\t\t}\n\n\t\t/**\n\t\t * Handles the Square payment form card nonce response.\n\t\t *\n\t\t * @since 2.1.0\n\t\t *\n\t\t * @param {Object} errors Validation errors, if any.\n\t\t * @param {string} nonce Payment nonce.\n\t\t * @param {Object} cardData Non-confidential info about the card used.\n\t\t */\n\t\thandle_card_nonce_response( errors, nonce, cardData ) {\n\t\t\t// if we have real errors to display from Square.\n\t\t\tif ( errors ) {\n\t\t\t\treturn this.handle_errors( errors );\n\t\t\t}\n\n\t\t\t// no errors, but also no payment data.\n\t\t\tif ( ! nonce ) {\n\t\t\t\tconst message = 'Nonce is missing from the Square response';\n\n\t\t\t\tthis.log( message, 'error' );\n\t\t\t\tthis.log_data( message, 'response' );\n\t\t\t\treturn this.handle_errors();\n\t\t\t}\n\n\t\t\t// if we made it this far, we have payment data.\n\t\t\tthis.log( 'Card data received' );\n\t\t\tthis.log( cardData );\n\t\t\tthis.log_data( cardData, 'response' );\n\n\t\t\tif ( cardData.last_4 ) {\n\t\t\t\t$( `input[name=wc-${ this.id_dasherized }-last-four]` ).val( cardData.last_4 );\n\t\t\t}\n\n\t\t\tif ( cardData.exp_month ) {\n\t\t\t\t$( `input[name=wc-${ this.id_dasherized }-exp-month]` ).val( cardData.exp_month );\n\t\t\t}\n\n\t\t\tif ( cardData.exp_year ) {\n\t\t\t\t$( `input[name=wc-${ this.id_dasherized }-exp-year]` ).val( cardData.exp_year );\n\t\t\t}\n\n\t\t\tif ( cardData.billing_postal_code ) {\n\t\t\t\t$( `input[name=wc-${ this.id_dasherized }-payment-postcode]` ).val( cardData.billing_postal_code );\n\t\t\t}\n\n\t\t\t// payment nonce data.\n\t\t\t$( `input[name=wc-${ this.id_dasherized }-payment-nonce]` ).val( nonce );\n\n\t\t\t// if 3ds is enabled, we need to verify the buyer and record the verification token before continuing.\n\t\t\tif ( this.is_3ds_enabled ) {\n\t\t\t\tthis.log( 'Verifying buyer' );\n\n\t\t\t\tthis.payment_form.verifyBuyer( nonce, this.get_verification_details(), this.handle_verify_buyer_response.bind( this ) );\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// now that we have a nonce, resubmit the form.\n\t\t\tthis.form.trigger( 'submit' );\n\t\t}\n\n\t\t/**\n\t\t * Handles the response from a call to verifyBuyer()\n\t\t *\n\t\t * @since 2.1.0\n\t\t *\n\t\t * @param {Object} errors Verification errors, if any.\n\t\t * @param {Object} verification_result Results of verification.\n\t\t */\n\t\thandle_verify_buyer_response( errors, verification_result ) {\n\t\t\tif ( errors ) {\n\t\t\t\t$( errors ).each( ( index, error ) => {\n\t\t\t\t\tif ( ! error.field ) {\n\t\t\t\t\t\terror.field = 'none';\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\treturn this.handle_errors( errors );\n\t\t\t}\n\n\t\t\t// no errors, but also no verification token.\n\t\t\tif ( ! verification_result || ! verification_result.token ) {\n\t\t\t\tconst message = 'Verification token is missing from the Square response';\n\n\t\t\t\tthis.log( message, 'error' );\n\t\t\t\tthis.log_data( message, 'response' );\n\n\t\t\t\treturn this.handle_errors();\n\t\t\t}\n\n\t\t\tthis.log( 'Verification result received' );\n\t\t\tthis.log( verification_result );\n\n\t\t\t$( `input[name=wc-${ this.id_dasherized }-buyer-verification-token]` ).val( verification_result.token );\n\n\t\t\tthis.form.trigger( 'submit' );\n\t\t}\n\n\t\t/**\n\t\t * Gets a verification details object to be used in verifyBuyer()\n\t\t *\n\t\t * @since 2.1.0\n\t\t *\n\t\t * @return {Object} Verification details object.\n\t\t */\n\t\tget_verification_details() {\n\t\t\tconst verification_details = {\n\t\t\t\tbillingContact: {\n\t\t\t\t\tfamilyName: $( '#billing_last_name' ).val() || '',\n\t\t\t\t\tgivenName: $( '#billing_first_name' ).val() || '',\n\t\t\t\t\temail: $( '#billing_email' ).val() || '',\n\t\t\t\t\tcountry: $( '#billing_country' ).val() || '',\n\t\t\t\t\tregion: $( '#billing_state' ).val() || '',\n\t\t\t\t\tcity: $( '#billing_city' ).val() || '',\n\t\t\t\t\tpostalCode: $( '#billing_postcode' ).val() || '',\n\t\t\t\t\tphone: $( '#billing_phone' ).val() || '',\n\t\t\t\t\taddressLines: [ $( '#billing_address_1' ).val() || '', $( '#billing_address_2' ).val() || '' ],\n\t\t\t\t},\n\t\t\t\tintent: this.get_intent(),\n\t\t\t};\n\n\t\t\tif ( 'CHARGE' === verification_details.intent ) {\n\t\t\t\tverification_details.amount = this.get_amount();\n\t\t\t\tverification_details.currencyCode = this.currency_code;\n\t\t\t}\n\n\t\t\tthis.log( verification_details );\n\n\t\t\treturn verification_details;\n\t\t}\n\n\t\t/**\n\t\t * Gets the intent of this processing - either 'CHARGE' or 'STORE'\n\t\t *\n\t\t * The gateway stores cards before processing a payment, so this checks whether the customer checked \"save method\"\n\t\t * at checkout, and isn't otherwise using a saved method already.\n\t\t *\n\t\t * @since 2.1.0\n\t\t *\n\t\t * @return {string} {'CHARGE'|'STORE'}\n\t\t */\n\t\tget_intent() {\n\t\t\tconst $save_method_input = $( '#wc-square-credit-card-tokenize-payment-method' );\n\n\t\t\tlet save_payment_method;\n\n\t\t\tif ( $save_method_input.is( 'input:checkbox' ) ) {\n\t\t\t\tsave_payment_method = $save_method_input.is( ':checked' );\n\t\t\t} else {\n\t\t\t\tsave_payment_method = 'true' === $save_method_input.val();\n\t\t\t}\n\n\t\t\tif ( ! this.get_tokenized_payment_method_id() && save_payment_method ) {\n\t\t\t\treturn 'STORE';\n\t\t\t}\n\n\t\t\treturn 'CHARGE';\n\t\t}\n\n\t\t/**\n\t\t * Gets the amount of this payment.\n\t\t *\n\t\t * @since 2.1.0\n\t\t *\n\t\t * @return {string} Payment amount.\n\t\t */\n\t\tget_amount() {\n\t\t\treturn $( `input[name=wc-${ this.id_dasherized }-amount]` ).val();\n\t\t}\n\n\t\t/**\n\t\t * Handles unsupported browsers.\n\t\t *\n\t\t * @since 2.0.0\n\t\t */\n\t\thandle_unsupported_browser() {}\n\n\t\t/**\n\t\t * Handle error data.\n\t\t *\n\t\t * @since 2.0.0\n\t\t *\n\t\t * @param {Object|null} errors\n\t\t */\n\t\thandle_errors( errors = null ) {\n\t\t\tthis.log( 'Error getting payment data', 'error' );\n\n\t\t\t// clear any previous nonces\n\t\t\t$( 'input[name=wc-square-credit-card-payment-nonce]' ).val( '' );\n\t\t\t$( 'input[name=wc-square-credit-card-buyer-verification-token]' ).val( '' );\n\n\t\t\tconst messages = [];\n\n\t\t\tif ( errors ) {\n\t\t\t\tconst field_order = [ 'none', 'cardNumber', 'expirationDate', 'cvv', 'postalCode' ];\n\n\t\t\t\tif ( errors.length >= 1 ) {\n\t\t\t\t\t// sort based on the field order without the brackets around a.field and b.field.\n\t\t\t\t\t// the precedence is different and gives different results.\n\t\t\t\t\terrors.sort( ( a, b ) => {\n\t\t\t\t\t\treturn field_order.indexOf( a.field ) - field_order.indexOf( b.field );\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\t$( errors ).each( ( index, error ) => {\n\t\t\t\t\t// only display the errors that can be helped by the customer.\n\t\t\t\t\tif ( 'UNSUPPORTED_CARD_BRAND' === error.type || 'VALIDATION_ERROR' === error.type ) {\n\t\t\t\t\t\t// To avoid confusion between CSC used in the frontend and CVV that is used in the error message.\n\t\t\t\t\t\treturn messages.push( error.message.replace( /CVV/, 'CSC' ) );\n\t\t\t\t\t}\n\n\t\t\t\t\t// otherwise, log more serious errors to the debug log.\n\t\t\t\t\treturn this.log_data( errors, 'response' );\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\t// if no specific messages are set, display a general error.\n\t\t\tif ( messages.length === 0 ) {\n\t\t\t\tmessages.push( this.general_error );\n\t\t\t}\n\n\t\t\t// Conditionally process error rendering.\n\t\t\tif ( ! this.is_add_payment_method_page && ! this.is_manual_order_payment ) {\n\t\t\t\tthis.render_checkout_errors( messages );\n\t\t\t} else {\n\t\t\t\tthis.render_errors( messages );\n\t\t\t}\n\n\t\t\tthis.unblock_ui();\n\t\t}\n\n\t\t/**\n\t\t * Public: Render any new errors and bring them into the viewport.\n\t\t *\n\t\t * @param {Array} errors\n\t\t */\n\t\trender_errors( errors ) {\n\t\t\t// hide and remove any previous errors.\n\t\t\t$( '.woocommerce-error, .woocommerce-message' ).remove();\n\n\t\t\t// add errors.\n\t\t\tthis.form.prepend( '<ul class=\"woocommerce-error\"><li>' + errors.join( '</li><li>' ) + '</li></ul>' );\n\n\t\t\t// unblock UI\n\t\t\tthis.form.removeClass( 'processing' ).unblock();\n\t\t\tthis.form.find( '.input-text, select' ).trigger( 'blur' );\n\n\t\t\t// scroll to top\n\t\t\t$( 'html, body' ).animate( {\n\t\t\t\tscrollTop: this.form.offset().top - 100,\n\t\t\t}, 1000 );\n\t\t}\n\n\t\t/**\n\t\t * Blocks the payment form UI.\n\t\t *\n\t\t * @since 3.0.0\n\t\t */\n\t\tblock_ui() {\n\t\t\tthis.form.block( {\n\t\t\t\tmessage: null,\n\t\t\t\toverlayCSS: {\n\t\t\t\t\tbackground: '#fff',\n\t\t\t\t\topacity: 0.6,\n\t\t\t\t},\n\t\t\t} );\n\t\t}\n\n\t\t/**\n\t\t * Unblocks the payment form UI.\n\t\t *\n\t\t * @since 3.0.0\n\t\t */\n\t\tunblock_ui() {\n\t\t\treturn this.form.unblock();\n\t\t}\n\n\t\t/**\n\t\t * Hides save payment method checkbox.\n\t\t *\n\t\t * @since 2.1.2\n\t\t *\n\t\t * @param {string} id_dasherized\n\t\t */\n\t\thide_save_payment_checkbox( id_dasherized ) {\n\t\t\tconst $parent_row = $( `input.js-wc-${ id_dasherized }-tokenize-payment-method` ).closest( 'p.form-row' );\n\n\t\t\t$parent_row.hide();\n\t\t\t$parent_row.next().hide();\n\t\t}\n\n\t\t/**\n\t\t * Shows save payment method checkbox.\n\t\t *\n\t\t * @since 2.1.2\n\t\t *\n\t\t * @param {string} id_dasherized\n\t\t */\n\t\tshow_save_payment_checkbox( id_dasherized ) {\n\t\t\tconst $parent_row = $( `input.js-wc-${ id_dasherized }-tokenize-payment-method` ).closest( 'p.form-row' );\n\n\t\t\t$parent_row.slideDown();\n\t\t\t$parent_row.next().show();\n\t\t}\n\n\t\t/**\n\t\t * Determines if a nonce is present in the hidden input.\n\t\t *\n\t\t * @since 2.0.0\n\t\t *\n\t\t * @return {boolean} True if nonce is present, otherwise false.\n\t\t */\n\t\thas_nonce() {\n\t\t\treturn $( `input[name=wc-${ this.id_dasherized }-payment-nonce]` ).val();\n\t\t}\n\n\t\t/**\n\t\t * Determines if a verification token is present in the hidden input.\n\t\t *\n\t\t * @since 2.1.0\n\t\t *\n\t\t * @return {boolean} True if verification token is present, otherwise false.\n\t\t */\n\t\thas_verification_token() {\n\t\t\treturn $( `input[name=wc-${ this.id_dasherized }-buyer-verification-token]` ).val();\n\t\t}\n\n\t\t/**\n\t\t * Logs data to the debug log via AJAX.\n\t\t *\n\t\t * @since 2.0.0\n\t\t *\n\t\t * @param {Object} data Request data.\n\t\t * @param {string} type Data type.\n\t\t */\n\t\tlog_data( data, type ) {\n\t\t\t// if logging is disabled, bail.\n\t\t\tif ( ! this.logging_enabled ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst ajax_data = {\n\t\t\t\taction: 'wc_' + this.id + '_log_js_data',\n\t\t\t\tsecurity: this.ajax_log_nonce,\n\t\t\t\ttype,\n\t\t\t\tdata,\n\t\t\t};\n\n\t\t\t$.ajax( {\n\t\t\t\turl: this.ajax_url,\n\t\t\t\tdata: ajax_data,\n\t\t\t} );\n\t\t}\n\n\t\t/**\n\t\t * Logs any messages or errors to the console.\n\t\t *\n\t\t * @since 2.0.0\n\t\t *\n\t\t * @param {string} message\n\t\t * @param {string} type Data type.\n\t\t */\n\t\tlog( message, type = 'notice' ) {\n\t\t\t// if logging is disabled, bail.\n\t\t\tif ( ! this.logging_enabled ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( 'error' === type ) {\n\t\t\t\tconsole.error( 'Square Error: ' + message );\n\t\t\t} else {\n\t\t\t\tconsole.log( 'Square: ' + message );\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * AJAX validate WooCommerce form data.\n\t\t *\n\t\t * Triggered only if errors are present on Square payment form.\n\t\t *\n\t\t * @since 2.2\n\t\t *\n\t\t * @param {Array} square_errors Square validation errors.\n\t\t */\n\t\trender_checkout_errors( square_errors ) {\n\t\t\tconst ajax_url = wc_cart_fragments_params.wc_ajax_url.toString().replace( '%%endpoint%%', this.id + '_checkout_handler' );\n\t\t\tconst square_handler = this;\n\n\t\t\tconst form_data = this.form.serializeArray();\n\n\t\t\t// Add action field to data for nonce verification.\n\t\t\tform_data.push( {\n\t\t\t\tname: 'wc_' + this.id + '_checkout_validate_nonce',\n\t\t\t\tvalue: this.ajax_wc_checkout_validate_nonce,\n\t\t\t} );\n\n\t\t\treturn $.ajax( {\n\t\t\t\turl: ajax_url,\n\t\t\t\tmethod: 'post',\n\t\t\t\tcache: false,\n\t\t\t\tdata: form_data,\n\t\t\t\tcomplete: ( response ) => {\n\t\t\t\t\tconst result = response.responseJSON;\n\n\t\t\t\t\t// If validation is not triggered and WooCommerce returns failure.\n\t\t\t\t\t// Temporary workaround to fix problems when user email is invalid.\n\t\t\t\t\tif ( result.hasOwnProperty( 'result' ) && 'failure' === result.result ) {\n\t\t\t\t\t\t$( result.messages ).map( ( message ) => {\n\t\t\t\t\t\t\tconst errors = [];\n\n\t\t\t\t\t\t\t$( message ).children( 'li' ).each( () => {\n\t\t\t\t\t\t\t\terrors.push( $( this ).text().trim() );\n\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\treturn square_errors.unshift( ...errors );\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t// If validation is complete and WooCommerce returns validaiton errors.\n\t\t\t\t\t} else if ( result.hasOwnProperty( 'success' ) && ! result.success ) {\n\t\t\t\t\t\tsquare_errors.unshift( ...result.data.messages );\n\t\t\t\t\t}\n\n\t\t\t\t\tsquare_handler.render_errors( square_errors );\n\t\t\t\t},\n\t\t\t} );\n\t\t}\n\t}\n\n\twindow.WC_Square_Payment_Form_Handler = WC_Square_Payment_Form_Handler;\n} );\n"],"file":"wc-square.min.js"}