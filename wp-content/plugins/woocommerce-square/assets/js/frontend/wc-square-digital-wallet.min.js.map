{"version":3,"sources":["wc-square-digital-wallet.js"],"names":["jQuery","document","ready","$","WC_Square_Digital_Wallet_Handler","args","payment_request","total_amount","total","amount","wallet","buttons","length","hide","build_digital_wallet","attach_page_events","block_ui","get_payment_request","then","response","JSON","parse","load_square_form","unblock_ui","message","log","context","addToCartButton","on","e","is","stopImmediatePropagation","window","alert","wc_add_to_cart_variation_params","i18n_unavailable_text","i18n_make_a_selection_text","add_to_cart","body","payment_form","destroy","SqPaymentForm","get_form_params","build","params","applicationId","application_id","locationId","location_id","autobuild","applePay","elementId","googlePay","callbacks","paymentFormLoaded","createPaymentRequest","create_payment_request","methodsSupported","methods","unsupportedReason","methods_supported","shippingContactChanged","shippingContact","done","handle_shipping_address_changed","shippingOptionChanged","shippingOption","handle_shipping_option_changed","cardNonceResponseReceived","errors","nonce","cardData","billingContact","handle_card_nonce_response","requestShippingAddress","hide_button_options","includes","show","Promise","resolve","reject","data","security","payment_request_nonce","product_data","get_product_data","extend","post","get_ajax_url","success","shipping_contact","recalculate_totals_nonce","recalculate_totals","error","shipping_option","id","render_errors","general_error","action","_wpnonce","process_checkout_nonce","billing_first_name","givenName","billing_last_name","familyName","billing_company","billing_email","email","billing_phone","phone","billing_country","country","toUpperCase","billing_address_1","addressLines","billing_address_2","billing_city","city","billing_state","region","billing_postcode","postalCode","shipping_first_name","shipping_last_name","shipping_company","shipping_country","shipping_address_1","shipping_address_2","shipping_city","shipping_state","shipping_postcode","shipping_method","order_comments","payment_method","ship_to_different_address","terms","last_4","exp_month","exp_year","billing_postal_code","digital_wallet_type","split","slice","join","is_3d_secure_enabled","self","verifyBuyer","get_verification_details","err","verificationResult","token","do_checkout","process_digital_wallet_checkout","location","redirect","render_errors_html","messages","verification_details","intent","currencyCode","product_id","val","attributes","find","each","index","select","attribute_name","attr","value","quantity","add_to_cart_nonce","result","request","ajax_url","replace","errors_html","remove","element","closest","before","animate","scrollTop","offset","top","error_message_html","block","overlayCSS","background","opacity","unblock","type","logging_enabled","console"],"mappings":"ioBAOAA,MAAM,CAAEC,QAAF,CAAN,CAAmBC,KAAnB,CAA0B,SAAEC,CAAF,CAAS,IAM5BC,CAAAA,gCAN4B,YAajC,0CAAaC,IAAb,CAAoB,wDACnB,KAAKA,IAAL,CAAYA,IAAZ,CACA,KAAKC,eAAL,CAAuBD,IAAI,CAACC,eAA5B,CACA,KAAKC,YAAL,CAAoBF,IAAI,CAACC,eAAL,CAAqBE,KAArB,CAA2BC,MAA/C,CACA,KAAKC,MAAL,CAAc,2BAAd,CACA,KAAKC,OAAL,CAAe,2BAAf,CAEA,GAAKR,CAAC,CAAE,KAAKO,MAAP,CAAD,CAAiBE,MAAjB,GAA4B,CAAjC,CAAqC,CACpC,MACA,CAEDT,CAAC,CAAE,KAAKO,MAAP,CAAD,CAAiBG,IAAjB,GACAV,CAAC,CAAE,KAAKQ,OAAP,CAAD,CAAkBE,IAAlB,GAEA,KAAKC,oBAAL,GACA,KAAKC,kBAAL,EACA,CA7BgC,iFAoCjC,+BAAuB,gBACtB,KAAKC,QAAL,GACA,KAAKC,mBAAL,GAA2BC,IAA3B,CACC,SAAEC,QAAF,CAAgB,CACf,KAAI,CAACb,eAAL,CAAuBc,IAAI,CAACC,KAAL,CAAYF,QAAZ,CAAvB,CACA,KAAI,CAACZ,YAAL,CAAoB,KAAI,CAACD,eAAL,CAAqBE,KAArB,CAA2BC,MAA/C,CACA,KAAI,CAACa,gBAAL,GACA,KAAI,CAACC,UAAL,EACA,CANF,CAOC,SAAEC,OAAF,CAAe,CACd,KAAI,CAACC,GAAL,CAAU,6CAA+CD,OAAzD,CAAkE,OAAlE,EACArB,CAAC,CAAE,KAAI,CAACO,MAAP,CAAD,CAAiBG,IAAjB,EACA,CAVF,CAYA,CAlDgC,kCAyDjC,6BAAqB,iBACpB,GAAK,KAAKR,IAAL,CAAUqB,OAAV,GAAsB,SAA3B,CAAuC,CACtC,GAAMC,CAAAA,eAAe,CAAGxB,CAAC,CAAE,4BAAF,CAAzB,CAEAA,CAAC,CAAE,6CAAF,CAAD,CAAmDyB,EAAnD,CAAuD,OAAvD,CAAgE,SAAEC,CAAF,CAAS,CACxE,GAAKF,eAAe,CAACG,EAAhB,CAAoB,WAApB,CAAL,CAAyC,CACxCD,CAAC,CAACE,wBAAF,GAEA,GAAKJ,eAAe,CAACG,EAAhB,CAAoB,8BAApB,CAAL,CAA4D,CAC3DE,MAAM,CAACC,KAAP,CAAcC,+BAA+B,CAACC,qBAA9C,CACA,CAFD,IAEO,IAAKR,eAAe,CAACG,EAAhB,CAAoB,gCAApB,CAAL,CAA8D,CACpEE,MAAM,CAACC,KAAP,CAAcC,+BAA+B,CAACE,0BAA9C,CACA,CACD,MACA,CAED,MAAI,CAACC,WAAL,EACA,CAbD,EAeAlC,CAAC,CAAEF,QAAQ,CAACqC,IAAX,CAAD,CAAmBV,EAAnB,CAAuB,mCAAvB,CAA4D,iBAAM,CAAA,MAAI,CAACd,oBAAL,EAAN,CAA5D,EAEAX,CAAC,CAAE,WAAF,CAAD,CAAiByB,EAAjB,CAAqB,OAArB,CAA8B,MAA9B,CAAsC,iBAAM,CAAA,MAAI,CAACd,oBAAL,EAAN,CAAtC,CACA,CAED,GAAK,KAAKT,IAAL,CAAUqB,OAAV,GAAsB,MAA3B,CAAoC,CACnCvB,CAAC,CAAEF,QAAQ,CAACqC,IAAX,CAAD,CAAmBV,EAAnB,CAAuB,qBAAvB,CAA8C,iBAAM,CAAA,MAAI,CAACd,oBAAL,EAAN,CAA9C,CACA,CAED,GAAK,KAAKT,IAAL,CAAUqB,OAAV,GAAsB,UAA3B,CAAwC,CACvCvB,CAAC,CAAEF,QAAQ,CAACqC,IAAX,CAAD,CAAmBV,EAAnB,CAAuB,kBAAvB,CAA2C,iBAAM,CAAA,MAAI,CAACd,oBAAL,EAAN,CAA3C,CACA,CACD,CAxFgC,gCA+FjC,2BAAmB,CAClB,GAAK,KAAKyB,YAAV,CAAyB,CACxB,KAAKd,GAAL,CAAU,iDAAV,EACA,KAAKc,YAAL,CAAkBC,OAAlB,EACA,CAED,KAAKf,GAAL,CAAU,+CAAV,EACA,KAAKc,YAAL,CAAoB,GAAIE,CAAAA,aAAJ,CAAmB,KAAKC,eAAL,EAAnB,CAApB,CACA,KAAKH,YAAL,CAAkBI,KAAlB,EACA,CAxGgC,+BA+GjC,0BAAkB,iBACjB,GAAMC,CAAAA,MAAM,CAAG,CACdC,aAAa,CAAE,KAAKxC,IAAL,CAAUyC,cADX,CAEdC,UAAU,CAAE,KAAK1C,IAAL,CAAU2C,WAFR,CAGdC,SAAS,CAAE,KAHG,CAIdC,QAAQ,CAAE,CACTC,SAAS,CAAE,qBADF,CAJI,CAOdC,SAAS,CAAE,CACVD,SAAS,CAAE,sBADD,CAPG,CAUdE,SAAS,CAAE,CACVC,iBAAiB,CAAE,mCAAM,CAAA,MAAI,CAAC/B,UAAL,EAAN,CADT,CAEVgC,oBAAoB,CAAE,sCAAM,CAAA,MAAI,CAACC,sBAAL,EAAN,CAFZ,CAGVC,gBAAgB,CAAE,0BAAEC,OAAF,CAAWC,iBAAX,QAAkC,CAAA,MAAI,CAACC,iBAAL,CAAwBF,OAAxB,CAAiCC,iBAAjC,CAAlC,CAHR,CAIVE,sBAAsB,CAAE,gCAAEC,eAAF,CAAmBC,IAAnB,QAA6B,CAAA,MAAI,CAACC,+BAAL,CAAsCF,eAAtC,CAAuDC,IAAvD,CAA7B,CAJd,CAKVE,qBAAqB,CAAE,+BAAEC,cAAF,CAAkBH,IAAlB,QAA4B,CAAA,MAAI,CAACI,8BAAL,CAAqCD,cAArC,CAAqDH,IAArD,CAA5B,CALb,CAMVK,yBAAyB,CAAE,mCAAEC,MAAF,CAAUC,KAAV,CAAiBC,QAAjB,CAA2BC,cAA3B,CAA2CV,eAA3C,CAA4DI,cAA5D,CAAgF,CAC1G,MAAI,CAACO,0BAAL,CAAiCJ,MAAjC,CAAyCC,KAAzC,CAAgDC,QAAhD,CAA0DC,cAA1D,CAA0EV,eAA1E,CAA2FI,cAA3F,CACA,CARS,CAVG,CAAf,CAuBA,GAAK,KAAK5D,eAAL,CAAqBoE,sBAArB,GAAgD,KAArD,CAA6D,CAC5D,MAAO9B,CAAAA,MAAM,CAACS,SAAP,CAAiBY,qBACxB,CAGD,GAAK,KAAK5D,IAAL,CAAUsE,mBAAV,CAA8BC,QAA9B,CAAwC,QAAxC,CAAL,CAA0D,CACzD,MAAOhC,CAAAA,MAAM,CAACQ,SACd,CAED,GAAK,KAAK/C,IAAL,CAAUsE,mBAAV,CAA8BC,QAA9B,CAAwC,OAAxC,CAAL,CAAyD,CACxD,MAAOhC,CAAAA,MAAM,CAACM,QACd,CAED,MAAON,CAAAA,MACP,CArJgC,sCA4JjC,iCAAyB,CACxB,MAAO,MAAKtC,eACZ,CA9JgC,iCAyKjC,2BAAmBoD,OAAnB,CAA4BC,iBAA5B,CAAgD,CAC/C,GAAKD,OAAO,CAACR,QAAR,GAAqB,IAArB,EAA6BQ,OAAO,CAACN,SAAR,GAAsB,IAAxD,CAA+D,CAC9D,GAAKM,OAAO,CAACR,QAAR,GAAqB,IAA1B,CAAiC,CAChC/C,CAAC,CAAE,sBAAF,CAAD,CAA4B0E,IAA5B,EACA,CAED,GAAKnB,OAAO,CAACN,SAAR,GAAsB,IAA3B,CAAkC,CACjCjD,CAAC,CAAE,uBAAF,CAAD,CAA6B0E,IAA7B,EACA,CAED1E,CAAC,CAAE,KAAKO,MAAP,CAAD,CAAiBmE,IAAjB,EACA,CAVD,IAUO,CACN,KAAKpD,GAAL,CAAUkC,iBAAV,CACA,CACD,CAvLgC,mCA8LjC,8BAAsB,iBACrB,MAAO,IAAImB,CAAAA,OAAJ,CAAa,SAAEC,OAAF,CAAWC,MAAX,CAAuB,CAC1C,GAAMC,CAAAA,IAAI,CAAG,CACZvD,OAAO,CAAE,MAAI,CAACrB,IAAL,CAAUqB,OADP,CAEZwD,QAAQ,CAAE,MAAI,CAAC7E,IAAL,CAAU8E,qBAFR,CAAb,CAKA,GAAK,MAAI,CAAC9E,IAAL,CAAUqB,OAAV,GAAsB,SAA3B,CAAuC,CACtC,GAAM0D,CAAAA,YAAY,CAAG,MAAI,CAACC,gBAAL,EAArB,CACAlF,CAAC,CAACmF,MAAF,CAAUL,IAAV,CAAgBG,YAAhB,CACA,CAEDjF,CAAC,CAACoF,IAAF,CAAQ,MAAI,CAACC,YAAL,CAAmB,qBAAnB,CAAR,CAAoDP,IAApD,CAA0D,SAAE9D,QAAF,CAAgB,CACzE,GAAKA,QAAQ,CAACsE,OAAd,CAAwB,CACvB,MAAOV,CAAAA,OAAO,CAAE5D,QAAQ,CAAC8D,IAAX,CACd,CAED,MAAOD,CAAAA,MAAM,CAAE7D,QAAQ,CAAC8D,IAAX,CACb,CAND,CAOA,CAlBM,CAmBP,CAlNgC,+CA2NjC,yCAAiCnB,eAAjC,CAAkDC,IAAlD,CAAyD,CACxD,GAAMkB,CAAAA,IAAI,CAAG,CACZvD,OAAO,CAAE,KAAKrB,IAAL,CAAUqB,OADP,CAEZgE,gBAAgB,CAAE5B,eAAe,CAACmB,IAFtB,CAGZC,QAAQ,CAAE,KAAK7E,IAAL,CAAUsF,wBAHR,CAAb,CAOA,KAAKC,kBAAL,CAAyBX,IAAzB,EAAgC/D,IAAhC,CAAsC,SAAEC,QAAF,CAAgB,CACrD,MAAO4C,CAAAA,IAAI,CAAE5C,QAAF,CACX,CAFD,CAEG,UAAM,CACR,MAAO4C,CAAAA,IAAI,CAAE,CACZ8B,KAAK,CAAE,aADK,CAAF,CAGX,CAND,CAOA,CA1OgC,8CAmPjC,wCAAgC3B,cAAhC,CAAgDH,IAAhD,CAAuD,CACtD,GAAMkB,CAAAA,IAAI,CAAG,CACZvD,OAAO,CAAE,KAAKrB,IAAL,CAAUqB,OADP,CAEZoE,eAAe,CAAE5B,cAAc,CAACe,IAAf,CAAoBc,EAFzB,CAGZb,QAAQ,CAAE,KAAK7E,IAAL,CAAUsF,wBAHR,CAAb,CAMA,KAAKC,kBAAL,CAAyBX,IAAzB,EAAgC/D,IAAhC,CAAsC,SAAEC,QAAF,CAAgB,CACrD,MAAO4C,CAAAA,IAAI,CAAE5C,QAAF,CACX,CAFD,CAEG,UAAM,CACR,MAAO4C,CAAAA,IAAI,CAAE,CACZ8B,KAAK,CAAE,aADK,CAAF,CAGX,CAND,CAOA,CAjQgC,0CA0QjC,oCAA4BxB,MAA5B,CAAoCC,KAApC,CAA2CC,QAA3C,CAAqDC,cAArD,CAAqEV,eAArE,CAAsFI,cAAtF,CAAuG,CACtG,GAAKG,MAAL,CAAc,CACb,MAAO,MAAK2B,aAAL,CAAoB3B,MAApB,CACP,CAED,GAAK,CAAEC,KAAP,CAAe,CACd,MAAO,MAAK0B,aAAL,CAAoB,KAAK3F,IAAL,CAAU4F,aAA9B,CACP,CAED,KAAKjF,QAAL,GAEA,GAAMiE,CAAAA,IAAI,CAAG,CACZiB,MAAM,CAAE,EADI,CAEZC,QAAQ,CAAE,KAAK9F,IAAL,CAAU+F,sBAFR,CAGZC,kBAAkB,CAAE7B,cAAc,CAAC8B,SAAf,CAA2B9B,cAAc,CAAC8B,SAA1C,CAAsD,EAH9D,CAIZC,iBAAiB,CAAE/B,cAAc,CAACgC,UAAf,CAA4BhC,cAAc,CAACgC,UAA3C,CAAwD,EAJ/D,CAKZC,eAAe,CAAE,EALL,CAMZC,aAAa,CAAE5C,eAAe,CAAC6C,KAAhB,CAAwB7C,eAAe,CAAC6C,KAAxC,CAAgD,EANnD,CAOZC,aAAa,CAAE9C,eAAe,CAAC+C,KAAhB,CAAwB/C,eAAe,CAAC+C,KAAxC,CAAgD,EAPnD,CAQZC,eAAe,CAAEtC,cAAc,CAACuC,OAAf,CAAyBvC,cAAc,CAACuC,OAAf,CAAuBC,WAAvB,EAAzB,CAAgE,EARrE,CASZC,iBAAiB,CAAEzC,cAAc,CAAC0C,YAAf,EAA+B1C,cAAc,CAAC0C,YAAf,CAA6B,CAA7B,CAA/B,CAAkE1C,cAAc,CAAC0C,YAAf,CAA6B,CAA7B,CAAlE,CAAqG,EAT5G,CAUZC,iBAAiB,CAAE3C,cAAc,CAAC0C,YAAf,EAA+B1C,cAAc,CAAC0C,YAAf,CAA6B,CAA7B,CAA/B,CAAkE1C,cAAc,CAAC0C,YAAf,CAA6B,CAA7B,CAAlE,CAAqG,EAV5G,CAWZE,YAAY,CAAE5C,cAAc,CAAC6C,IAAf,CAAsB7C,cAAc,CAAC6C,IAArC,CAA4C,EAX9C,CAYZC,aAAa,CAAE9C,cAAc,CAAC+C,MAAf,CAAwB/C,cAAc,CAAC+C,MAAvC,CAAgD,EAZnD,CAaZC,gBAAgB,CAAEhD,cAAc,CAACiD,UAAf,CAA4BjD,cAAc,CAACiD,UAA3C,CAAwD,EAb9D,CAcZC,mBAAmB,CAAE5D,eAAe,CAACwC,SAAhB,CAA4BxC,eAAe,CAACwC,SAA5C,CAAwD,EAdjE,CAeZqB,kBAAkB,CAAE7D,eAAe,CAAC0C,UAAhB,CAA6B1C,eAAe,CAAC0C,UAA7C,CAA0D,EAflE,CAgBZoB,gBAAgB,CAAE,EAhBN,CAiBZC,gBAAgB,CAAE/D,eAAe,CAACiD,OAAhB,CAA0BjD,eAAe,CAACiD,OAAhB,CAAwBC,WAAxB,EAA1B,CAAkE,EAjBxE,CAkBZc,kBAAkB,CAAEhE,eAAe,CAACoD,YAAhB,EAAgCpD,eAAe,CAACoD,YAAhB,CAA8B,CAA9B,CAAhC,CAAoEpD,eAAe,CAACoD,YAAhB,CAA8B,CAA9B,CAApE,CAAwG,EAlBhH,CAmBZa,kBAAkB,CAAEjE,eAAe,CAACoD,YAAhB,EAAgCpD,eAAe,CAACoD,YAAhB,CAA8B,CAA9B,CAAhC,CAAoEpD,eAAe,CAACoD,YAAhB,CAA8B,CAA9B,CAApE,CAAwG,EAnBhH,CAoBZc,aAAa,CAAElE,eAAe,CAACuD,IAAhB,CAAuBvD,eAAe,CAACuD,IAAvC,CAA8C,EApBjD,CAqBZY,cAAc,CAAEnE,eAAe,CAACyD,MAAhB,CAAyBzD,eAAe,CAACyD,MAAzC,CAAkD,EArBtD,CAsBZW,iBAAiB,CAAEpE,eAAe,CAAC2D,UAAhB,CAA6B3D,eAAe,CAAC2D,UAA7C,CAA0D,EAtBjE,CAuBZU,eAAe,CAAE,CAAE,CAAEjE,cAAF,CAAmB,IAAnB,CAA0BA,cAAc,CAAC6B,EAA3C,CAvBL,CAwBZqC,cAAc,CAAE,EAxBJ,CAyBZC,cAAc,CAAE,oBAzBJ,CA0BZC,yBAAyB,CAAE,CA1Bf,CA2BZC,KAAK,CAAE,CA3BK,CA4BZ,sCAAuCjE,KA5B3B,CA6BZ,kCAAmCC,QAAQ,CAACiE,MAAT,CAAkBjE,QAAQ,CAACiE,MAA3B,CAAoC,IA7B3D,CA8BZ,kCAAmCjE,QAAQ,CAACkE,SAAT,CAAqBlE,QAAQ,CAACkE,SAA9B,CAA0C,IA9BjE,CA+BZ,iCAAkClE,QAAQ,CAACmE,QAAT,CAAoBnE,QAAQ,CAACmE,QAA7B,CAAwC,IA/B9D,CAgCZ,yCAA0CnE,QAAQ,CAACoE,mBAAT,CAA+BpE,QAAQ,CAACoE,mBAAxC,CAA8D,IAhC5F,CAiCZ,gCAAiCpE,QAAQ,CAACqE,mBAjC9B,CAAb,CAqCA,GAAKrE,QAAQ,CAACqE,mBAAT,GAAiC,YAAtC,CAAqD,CACpD,GAAKpE,cAAc,CAAC8B,SAApB,CAAgC,CAC/BrB,IAAI,CAACoB,kBAAL,CAA0B7B,cAAc,CAAC8B,SAAf,CAAyBuC,KAAzB,CAAgC,GAAhC,EAAsCC,KAAtC,CAA6C,CAA7C,CAAgD,CAAhD,EAAoDC,IAApD,CAA0D,GAA1D,CAA1B,CACA9D,IAAI,CAACsB,iBAAL,CAAyB/B,cAAc,CAAC8B,SAAf,CAAyBuC,KAAzB,CAAgC,GAAhC,EAAsCC,KAAtC,CAA6C,CAA7C,EAAiDC,IAAjD,CAAuD,GAAvD,CACzB,CAED,GAAKjF,eAAe,CAACwC,SAArB,CAAiC,CAChCrB,IAAI,CAAC0C,kBAAL,CAA0B7D,eAAe,CAACwC,SAAhB,CAA0BuC,KAA1B,CAAiC,GAAjC,EAAuCC,KAAvC,CAA8C,CAA9C,CAAiD,CAAjD,EAAqDC,IAArD,CAA2D,GAA3D,CAA1B,CACA9D,IAAI,CAAC0C,kBAAL,CAA0B7D,eAAe,CAACwC,SAAhB,CAA0BuC,KAA1B,CAAiC,GAAjC,EAAuCC,KAAvC,CAA8C,CAA9C,EAAkDC,IAAlD,CAAwD,GAAxD,CAC1B,CACD,CAGD,GAAK,CAAE9D,IAAI,CAAC2B,aAAP,EAAwBpC,cAAc,CAACqC,KAA5C,CAAoD,CACnD5B,IAAI,CAAC2B,aAAL,CAAqBpC,cAAc,CAACqC,KACpC,CAGD,GAAK,KAAKxG,IAAL,CAAU2I,oBAAf,CAAsC,CACrC,KAAKvH,GAAL,CAAU,2CAAV,EAEA,GAAIwH,CAAAA,IAAI,CAAG,IAAX,CAEA,KAAK1G,YAAL,CAAkB2G,WAAlB,CACC5E,KADD,CAEC2E,IAAI,CAACE,wBAAL,CAA+B3E,cAA/B,CAA+CV,eAA/C,CAFD,CAGC,SAASsF,GAAT,CAAcC,kBAAd,CAAkC,CACjC,GAAID,GAAG,EAAI,IAAX,CAAiB,CAEhBH,IAAI,CAACxH,GAAL,CAAU,6BAAV,EACAwD,IAAI,CAAC,gDAAD,CAAJ,CAAyDoE,kBAAkB,CAACC,KAA5E,CACAL,IAAI,CAACM,WAAL,CAAkBtE,IAAlB,CACA,CALD,IAKO,CAENgE,IAAI,CAACxH,GAAL,CAAU,yBAAV,EACAwH,IAAI,CAACxH,GAAL,CAAS2H,GAAT,EACAH,IAAI,CAACjD,aAAL,CAAoB,CAACoD,GAAG,CAAC5H,OAAL,CAApB,CACA,CACD,CAfF,CAiBA,CAtBD,IAsBO,CAEN,KAAK+H,WAAL,CAAkBtE,IAAlB,CACA,CACD,CAtWgC,2BA+WjC,qBAAaA,IAAb,CAAoB,iBAEnB,KAAKuE,+BAAL,CAAsCvE,IAAtC,EAA6C/D,IAA7C,CACC,SAAEC,QAAF,CAAgB,CACfa,MAAM,CAACyH,QAAP,CAAkBtI,QAAQ,CAACuI,QAC3B,CAHF,CAIC,SAAEvI,QAAF,CAAgB,CACf,MAAI,CAACM,GAAL,CAAUN,QAAV,CAAoB,OAApB,EACA,MAAI,CAACwI,kBAAL,CAAyBxI,QAAQ,CAACyI,QAAlC,CACA,CAPF,CASA,CA1XgC,wCAsYjC,kCAA0BpF,cAA1B,CAA0CV,eAA1C,CAA4D,CAC3D,GAAM+F,CAAAA,oBAAoB,CAAG,CAC5BC,MAAM,CAAE,QADoB,CAE5BrJ,MAAM,CAAE,KAAKF,YAFe,CAG5BwJ,YAAY,CAAE,KAAKzJ,eAAL,CAAqByJ,YAHP,CAI5BvF,cAAc,CAAE,CACfgC,UAAU,CAAEhC,cAAc,CAACgC,UAAf,CAA4BhC,cAAc,CAACgC,UAA3C,CAAwD,EADrD,CAEfF,SAAS,CAAE9B,cAAc,CAAC8B,SAAf,CAA2B9B,cAAc,CAAC8B,SAA1C,CAAsD,EAFlD,CAGfK,KAAK,CAAE7C,eAAe,CAAC6C,KAAhB,CAAwB7C,eAAe,CAAC6C,KAAxC,CAAgD,EAHxC,CAIfI,OAAO,CAAEvC,cAAc,CAACuC,OAAf,CAAyBvC,cAAc,CAACuC,OAAf,CAAuBC,WAAvB,EAAzB,CAAgE,EAJ1D,CAKfO,MAAM,CAAE/C,cAAc,CAAC+C,MAAf,CAAwB/C,cAAc,CAAC+C,MAAvC,CAAgD,EALzC,CAMfF,IAAI,CAAE7C,cAAc,CAAC6C,IAAf,CAAsB7C,cAAc,CAAC6C,IAArC,CAA4C,EANnC,CAOfI,UAAU,CAAEjD,cAAc,CAACiD,UAAf,CAA4BjD,cAAc,CAACiD,UAA3C,CAAwD,EAPrD,CAQfZ,KAAK,CAAE/C,eAAe,CAAC+C,KAAhB,CAAwB/C,eAAe,CAAC+C,KAAxC,CAAgD,EARxC,CASfK,YAAY,CAAE1C,cAAc,CAAC0C,YAAf,CAA8B1C,cAAc,CAAC0C,YAA7C,CAA4D,EAT3D,CAJY,CAA7B,CAiBA,KAAKzF,GAAL,CAAUoI,oBAAV,EAEA,MAAOA,CAAAA,oBACP,CA3ZgC,kCAkajC,4BAAoB5E,IAApB,CAA2B,iBAC1B,MAAO,IAAIH,CAAAA,OAAJ,CAAa,SAAEC,OAAF,CAAWC,MAAX,CAAuB,CAC1C,MAAO7E,CAAAA,CAAC,CAACoF,IAAF,CAAQ,MAAI,CAACC,YAAL,CAAmB,oBAAnB,CAAR,CAAmDP,IAAnD,CAAyD,SAAE9D,QAAF,CAAgB,CAC/E,GAAKA,QAAQ,CAACsE,OAAd,CAAwB,CACvB,MAAI,CAAClF,YAAL,CAAoBY,QAAQ,CAAC8D,IAAT,CAAczE,KAAd,CAAoBC,MAAxC,CACA,MAAOsE,CAAAA,OAAO,CAAE5D,QAAQ,CAAC8D,IAAX,CACd,CACD,MAAOD,CAAAA,MAAM,CAAE7D,QAAQ,CAAC8D,IAAX,CACb,CANM,CAOP,CARM,CASP,CA5agC,gCAmbjC,2BAAmB,CAClB,GAAI+E,CAAAA,UAAU,CAAG7J,CAAC,CAAE,4BAAF,CAAD,CAAkC8J,GAAlC,EAAjB,CAEA,GAAMC,CAAAA,UAAU,CAAG,EAAnB,CAGA,GAAK/J,CAAC,CAAE,wBAAF,CAAD,CAA8BS,MAAnC,CAA4C,CAC3CoJ,UAAU,CAAG7J,CAAC,CAAE,wBAAF,CAAD,CAA8BgK,IAA9B,CAAoC,4BAApC,EAAiEF,GAAjE,EAAb,CACA,GAAK9J,CAAC,CAAE,kBAAF,CAAD,CAAwBS,MAA7B,CAAsC,CACrCT,CAAC,CAAE,kBAAF,CAAD,CAAwBgK,IAAxB,CAA8B,oBAA9B,EAAqDC,IAArD,CAA2D,SAAEC,KAAF,CAASC,MAAT,CAAqB,CAC/E,GAAMC,CAAAA,cAAc,CAAGpK,CAAC,CAAEmK,MAAF,CAAD,CAAYrF,IAAZ,CAAkB,gBAAlB,GAAwC9E,CAAC,CAAEmK,MAAF,CAAD,CAAYE,IAAZ,CAAkB,MAAlB,CAA/D,CACA,GAAMC,CAAAA,KAAK,CAAGtK,CAAC,CAAEmK,MAAF,CAAD,CAAYL,GAAZ,IAAqB,EAAnC,CACA,MAAOC,CAAAA,UAAU,CAAEK,cAAF,CAAV,CAA+BE,KACtC,CAJD,CAKA,CACD,CAED,MAAO,CACNT,UAAU,CAAVA,UADM,CAENU,QAAQ,CAAEvK,CAAC,CAAE,gBAAF,CAAD,CAAsB8J,GAAtB,EAFJ,CAGNC,UAAU,CAAVA,UAHM,CAKP,CAzcgC,2BAgdjC,sBAAc,iBACb,GAAMjF,CAAAA,IAAI,CAAG,CACZC,QAAQ,CAAE,KAAK7E,IAAL,CAAUsK,iBADR,CAAb,CAGA,GAAMvF,CAAAA,YAAY,CAAG,KAAKC,gBAAL,EAArB,CACAlF,CAAC,CAACmF,MAAF,CAAUL,IAAV,CAAgBG,YAAhB,EAGAjF,CAAC,CAACoF,IAAF,CAAQ,KAAKC,YAAL,CAAmB,aAAnB,CAAR,CAA4CP,IAA5C,CAAkD,SAAE9D,QAAF,CAAgB,CACjE,GAAKA,QAAQ,CAAC0E,KAAd,CAAsB,CACrB,MAAO7D,CAAAA,MAAM,CAACC,KAAP,CAAcd,QAAQ,CAAC8D,IAAvB,CACP,CAED,GAAMA,CAAAA,IAAI,CAAG7D,IAAI,CAACC,KAAL,CAAYF,QAAQ,CAAC8D,IAArB,CAAb,CACA,MAAI,CAAC3E,eAAL,CAAuB2E,IAAI,CAAC3E,eAA5B,CACA,MAAI,CAACD,IAAL,CAAU8E,qBAAV,CAAkCF,IAAI,CAACE,qBAAvC,CACA,MAAI,CAAC9E,IAAL,CAAUsK,iBAAV,CAA8B1F,IAAI,CAAC0F,iBAAnC,CACA,MAAI,CAACtK,IAAL,CAAUsF,wBAAV,CAAqCV,IAAI,CAACU,wBAA1C,CACA,MAAI,CAACtF,IAAL,CAAU+F,sBAAV,CAAmCnB,IAAI,CAACmB,sBACxC,CAXD,CAYA,CApegC,+CA2ejC,yCAAiCnB,IAAjC,CAAwC,iBACvC,MAAO,IAAIH,CAAAA,OAAJ,CAAa,SAAEC,OAAF,CAAWC,MAAX,CAAuB,CAC1C7E,CAAC,CAACoF,IAAF,CAAQ,MAAI,CAACC,YAAL,CAAmB,kBAAnB,CAAR,CAAiDP,IAAjD,CAAuD,SAAE9D,QAAF,CAAgB,CACtE,GAAKA,QAAQ,CAACyJ,MAAT,GAAoB,SAAzB,CAAqC,CACpC,MAAO7F,CAAAA,OAAO,CAAE5D,QAAF,CACd,CAED,MAAO6D,CAAAA,MAAM,CAAE7D,QAAF,CACb,CAND,CAOA,CARM,CASP,CArfgC,4BA4fjC,sBAAc0J,OAAd,CAAwB,CACvB,MAAO,MAAKxK,IAAL,CAAUyK,QAAV,CAAmBC,OAAnB,CAA4B,cAA5B,CAA4C,yBAA2BF,OAAvE,CACP,CA9fgC,kCAqgBjC,4BAAoBG,WAApB,CAAkC,CAEjC7K,CAAC,CAAE,0CAAF,CAAD,CAAgD8K,MAAhD,GAEA,GAAMC,CAAAA,OAAO,CAAG,KAAK7K,IAAL,CAAUqB,OAAV,GAAsB,SAAtB,CAAkCvB,CAAC,CAAE,UAAF,CAAnC,CAAoDA,CAAC,CAAE,kBAAF,CAAD,CAAwBgL,OAAxB,CAAiC,MAAjC,CAApE,CAGAD,OAAO,CAACE,MAAR,CAAgBJ,WAAhB,EAGA,KAAKzJ,UAAL,GAGApB,CAAC,CAAE,YAAF,CAAD,CAAkBkL,OAAlB,CAA2B,CAC1BC,SAAS,CAAEJ,OAAO,CAACK,MAAR,GAAiBC,GAAjB,CAAuB,GADR,CAA3B,CAEG,IAFH,CAGA,CArhBgC,6BA4hBjC,uBAAenH,MAAf,CAAwB,CACvB,GAAMoH,CAAAA,kBAAkB,CAAG,uCAAuCpH,MAAM,CAAC0E,IAAP,CAAa,WAAb,CAAvC,CAAoE,YAA/F,CACA,KAAKY,kBAAL,CAAyB8B,kBAAzB,CACA,CA/hBgC,wBAsiBjC,mBAAW,CACVtL,CAAC,CAAE,KAAKQ,OAAP,CAAD,CAAkB+K,KAAlB,CAAyB,CACxBlK,OAAO,CAAE,IADe,CAExBmK,UAAU,CAAE,CACXC,UAAU,CAAE,MADD,CAEXC,OAAO,CAAE,GAFE,CAFY,CAAzB,CAOA,CA9iBgC,0BAqjBjC,qBAAa,CACZ1L,CAAC,CAAE,KAAKQ,OAAP,CAAD,CAAkBmL,OAAlB,EACA,CAvjBgC,mBA8jBjC,aAAKtK,OAAL,CAAgC,IAAlBuK,CAAAA,IAAkB,2DAAX,QAAW,CAE/B,GAAK,CAAE,KAAK1L,IAAL,CAAU2L,eAAjB,CAAmC,CAClC,MACA,CAED,GAAKD,IAAI,GAAK,OAAd,CAAwB,CACvB,MAAOE,CAAAA,OAAO,CAACpG,KAAR,CAAerE,OAAf,CACP,CAED,MAAOyK,CAAAA,OAAO,CAACxK,GAAR,CAAaD,OAAb,CACP,CAzkBgC,+CA4kBlCQ,MAAM,CAAC5B,gCAAP,CAA0CA,gCAC1C,CA7kBD","sourcesContent":["/* global wc_add_to_cart_variation_params, SqPaymentForm */\n\n/**\n * Square Credit Card Digital Wallet Handler class.\n *\n * @since 2.3\n */\njQuery( document ).ready( ( $ ) => {\n\t/**\n\t * Square Credit Card Digital Wallet Handler class.\n\t *\n\t * @since 2.3\n\t */\n\tclass WC_Square_Digital_Wallet_Handler {\n\t\t/**\n\t\t * Setup handler\n\t\t *\n\t\t * @param {Array} args\n\t\t * @since 2.3\n\t\t */\n\t\tconstructor( args ) {\n\t\t\tthis.args = args;\n\t\t\tthis.payment_request = args.payment_request;\n\t\t\tthis.total_amount = args.payment_request.total.amount;\n\t\t\tthis.wallet = '#wc-square-digital-wallet';\n\t\t\tthis.buttons = '.wc-square-wallet-buttons';\n\n\t\t\tif ( $( this.wallet ).length === 0 ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$( this.wallet ).hide();\n\t\t\t$( this.buttons ).hide();\n\n\t\t\tthis.build_digital_wallet();\n\t\t\tthis.attach_page_events();\n\t\t}\n\n\t\t/**\n\t\t * Fetch a new payment request object and reload the SqPaymentForm\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\tbuild_digital_wallet() {\n\t\t\tthis.block_ui();\n\t\t\tthis.get_payment_request().then(\n\t\t\t\t( response ) => {\n\t\t\t\t\tthis.payment_request = JSON.parse( response );\n\t\t\t\t\tthis.total_amount = this.payment_request.total.amount;\n\t\t\t\t\tthis.load_square_form();\n\t\t\t\t\tthis.unblock_ui();\n\t\t\t\t},\n\t\t\t\t( message ) => {\n\t\t\t\t\tthis.log( '[Square] Could not build payment request. ' + message, 'error' );\n\t\t\t\t\t$( this.wallet ).hide();\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * Add page event listeners\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\tattach_page_events() {\n\t\t\tif ( this.args.context === 'product' ) {\n\t\t\t\tconst addToCartButton = $( '.single_add_to_cart_button' );\n\n\t\t\t\t$( '#wc-square-apple-pay, #wc-square-google-pay' ).on( 'click', ( e ) => {\n\t\t\t\t\tif ( addToCartButton.is( '.disabled' ) ) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\n\t\t\t\t\t\tif ( addToCartButton.is( '.wc-variation-is-unavailable' ) ) {\n\t\t\t\t\t\t\twindow.alert( wc_add_to_cart_variation_params.i18n_unavailable_text );\n\t\t\t\t\t\t} else if ( addToCartButton.is( '.wc-variation-selection-needed' ) ) {\n\t\t\t\t\t\t\twindow.alert( wc_add_to_cart_variation_params.i18n_make_a_selection_text );\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.add_to_cart();\n\t\t\t\t} );\n\n\t\t\t\t$( document.body ).on( 'woocommerce_variation_has_changed', () => this.build_digital_wallet() );\n\n\t\t\t\t$( '.quantity' ).on( 'input', '.qty', () => this.build_digital_wallet() );\n\t\t\t}\n\n\t\t\tif ( this.args.context === 'cart' ) {\n\t\t\t\t$( document.body ).on( 'updated_cart_totals', () => this.build_digital_wallet() );\n\t\t\t}\n\n\t\t\tif ( this.args.context === 'checkout' ) {\n\t\t\t\t$( document.body ).on( 'updated_checkout', () => this.build_digital_wallet() );\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Load the digital wallet payment form\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\tload_square_form() {\n\t\t\tif ( this.payment_form ) {\n\t\t\t\tthis.log( '[Square] Destroying digital wallet payment form' );\n\t\t\t\tthis.payment_form.destroy();\n\t\t\t}\n\n\t\t\tthis.log( '[Square] Building digital wallet payment form' );\n\t\t\tthis.payment_form = new SqPaymentForm( this.get_form_params() );\n\t\t\tthis.payment_form.build();\n\t\t}\n\n\t\t/**\n\t\t * Gets the Square payment form params.\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\tget_form_params() {\n\t\t\tconst params = {\n\t\t\t\tapplicationId: this.args.application_id,\n\t\t\t\tlocationId: this.args.location_id,\n\t\t\t\tautobuild: false,\n\t\t\t\tapplePay: {\n\t\t\t\t\telementId: 'wc-square-apple-pay',\n\t\t\t\t},\n\t\t\t\tgooglePay: {\n\t\t\t\t\telementId: 'wc-square-google-pay',\n\t\t\t\t},\n\t\t\t\tcallbacks: {\n\t\t\t\t\tpaymentFormLoaded: () => this.unblock_ui(),\n\t\t\t\t\tcreatePaymentRequest: () => this.create_payment_request(),\n\t\t\t\t\tmethodsSupported: ( methods, unsupportedReason ) => this.methods_supported( methods, unsupportedReason ),\n\t\t\t\t\tshippingContactChanged: ( shippingContact, done ) => this.handle_shipping_address_changed( shippingContact, done ),\n\t\t\t\t\tshippingOptionChanged: ( shippingOption, done ) => this.handle_shipping_option_changed( shippingOption, done ),\n\t\t\t\t\tcardNonceResponseReceived: ( errors, nonce, cardData, billingContact, shippingContact, shippingOption ) => {\n\t\t\t\t\t\tthis.handle_card_nonce_response( errors, nonce, cardData, billingContact, shippingContact, shippingOption );\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\n\t\t\t// Fix console errors for Google Pay when there are no shipping options set. See note in Square documentation under shippingOptions: https://developer.squareup.com/docs/api/paymentform#paymentrequestfields.\n\t\t\tif ( this.payment_request.requestShippingAddress === false ) {\n\t\t\t\tdelete params.callbacks.shippingOptionChanged;\n\t\t\t}\n\n\t\t\t// Remove support for Google Pay and/or Apple Pay if chosen in settings.\n\t\t\tif ( this.args.hide_button_options.includes( 'google' ) ) {\n\t\t\t\tdelete params.googlePay;\n\t\t\t}\n\n\t\t\tif ( this.args.hide_button_options.includes( 'apple' ) ) {\n\t\t\t\tdelete params.applePay;\n\t\t\t}\n\n\t\t\treturn params;\n\t\t}\n\n\t\t/**\n\t\t * Sets the a payment request object for the Square Payment Form\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\tcreate_payment_request() {\n\t\t\treturn this.payment_request;\n\t\t}\n\n\t\t/**\n\t\t * Check which methods are supported and show/hide the correct buttons on frontend\n\t\t * Reference: https://developer.squareup.com/docs/api/paymentform#methodssupported\n\t\t *\n\t\t * @param {Object} methods\n\t\t * @param {string} unsupportedReason\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\tmethods_supported( methods, unsupportedReason ) {\n\t\t\tif ( methods.applePay === true || methods.googlePay === true ) {\n\t\t\t\tif ( methods.applePay === true ) {\n\t\t\t\t\t$( '#wc-square-apple-pay' ).show();\n\t\t\t\t}\n\n\t\t\t\tif ( methods.googlePay === true ) {\n\t\t\t\t\t$( '#wc-square-google-pay' ).show();\n\t\t\t\t}\n\n\t\t\t\t$( this.wallet ).show();\n\t\t\t} else {\n\t\t\t\tthis.log( unsupportedReason );\n\t\t\t}\n\t\t}\n\n\t\t/*\n\t\t * Get the payment request on a product page\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\tget_payment_request() {\n\t\t\treturn new Promise( ( resolve, reject ) => {\n\t\t\t\tconst data = {\n\t\t\t\t\tcontext: this.args.context,\n\t\t\t\t\tsecurity: this.args.payment_request_nonce,\n\t\t\t\t};\n\n\t\t\t\tif ( this.args.context === 'product' ) {\n\t\t\t\t\tconst product_data = this.get_product_data();\n\t\t\t\t\t$.extend( data, product_data );\n\t\t\t\t}\n\t\t\t\t// retrieve a payment request object.\n\t\t\t\t$.post( this.get_ajax_url( 'get_payment_request' ), data, ( response ) => {\n\t\t\t\t\tif ( response.success ) {\n\t\t\t\t\t\treturn resolve( response.data );\n\t\t\t\t\t}\n\n\t\t\t\t\treturn reject( response.data );\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\n\t\t/*\n\t\t * Handle all shipping address recalculations in the Apple/Google Pay window\n\t\t *\n\t\t * Reference: https://developer.squareup.com/docs/api/paymentform#shippingcontactchanged\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\thandle_shipping_address_changed( shippingContact, done ) {\n\t\t\tconst data = {\n\t\t\t\tcontext: this.args.context,\n\t\t\t\tshipping_contact: shippingContact.data,\n\t\t\t\tsecurity: this.args.recalculate_totals_nonce,\n\t\t\t};\n\n\t\t\t// send ajax request get_shipping_options.\n\t\t\tthis.recalculate_totals( data ).then( ( response ) => {\n\t\t\t\treturn done( response );\n\t\t\t}, () => {\n\t\t\t\treturn done( {\n\t\t\t\t\terror: 'Bad Request',\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\n\t\t/*\n\t\t * Handle all shipping method changes in the Apple/Google Pay window\n\t\t *\n\t\t * Reference: https://developer.squareup.com/docs/api/paymentform#shippingoptionchanged\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\thandle_shipping_option_changed( shippingOption, done ) {\n\t\t\tconst data = {\n\t\t\t\tcontext: this.args.context,\n\t\t\t\tshipping_option: shippingOption.data.id,\n\t\t\t\tsecurity: this.args.recalculate_totals_nonce,\n\t\t\t};\n\n\t\t\tthis.recalculate_totals( data ).then( ( response ) => {\n\t\t\t\treturn done( response );\n\t\t\t}, () => {\n\t\t\t\treturn done( {\n\t\t\t\t\terror: 'Bad Request',\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\n\t\t/*\n\t\t * Handle the payment response.\n\t\t *\n\t\t * On success, set the checkout billing/shipping data and submit the checkout.\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\thandle_card_nonce_response( errors, nonce, cardData, billingContact, shippingContact, shippingOption ) {\n\t\t\tif ( errors ) {\n\t\t\t\treturn this.render_errors( errors );\n\t\t\t}\n\n\t\t\tif ( ! nonce ) {\n\t\t\t\treturn this.render_errors( this.args.general_error );\n\t\t\t}\n\n\t\t\tthis.block_ui();\n\n\t\t\tconst data = {\n\t\t\t\taction: '',\n\t\t\t\t_wpnonce: this.args.process_checkout_nonce,\n\t\t\t\tbilling_first_name: billingContact.givenName ? billingContact.givenName : '',\n\t\t\t\tbilling_last_name: billingContact.familyName ? billingContact.familyName : '',\n\t\t\t\tbilling_company: '',\n\t\t\t\tbilling_email: shippingContact.email ? shippingContact.email : '',\n\t\t\t\tbilling_phone: shippingContact.phone ? shippingContact.phone : '',\n\t\t\t\tbilling_country: billingContact.country ? billingContact.country.toUpperCase() : '',\n\t\t\t\tbilling_address_1: billingContact.addressLines && billingContact.addressLines[ 0 ] ? billingContact.addressLines[ 0 ] : '',\n\t\t\t\tbilling_address_2: billingContact.addressLines && billingContact.addressLines[ 1 ] ? billingContact.addressLines[ 1 ] : '',\n\t\t\t\tbilling_city: billingContact.city ? billingContact.city : '',\n\t\t\t\tbilling_state: billingContact.region ? billingContact.region : '',\n\t\t\t\tbilling_postcode: billingContact.postalCode ? billingContact.postalCode : '',\n\t\t\t\tshipping_first_name: shippingContact.givenName ? shippingContact.givenName : '',\n\t\t\t\tshipping_last_name: shippingContact.familyName ? shippingContact.familyName : '',\n\t\t\t\tshipping_company: '',\n\t\t\t\tshipping_country: shippingContact.country ? shippingContact.country.toUpperCase() : '',\n\t\t\t\tshipping_address_1: shippingContact.addressLines && shippingContact.addressLines[ 0 ] ? shippingContact.addressLines[ 0 ] : '',\n\t\t\t\tshipping_address_2: shippingContact.addressLines && shippingContact.addressLines[ 1 ] ? shippingContact.addressLines[ 1 ] : '',\n\t\t\t\tshipping_city: shippingContact.city ? shippingContact.city : '',\n\t\t\t\tshipping_state: shippingContact.region ? shippingContact.region : '',\n\t\t\t\tshipping_postcode: shippingContact.postalCode ? shippingContact.postalCode : '',\n\t\t\t\tshipping_method: [ ! shippingOption ? null : shippingOption.id ],\n\t\t\t\torder_comments: '',\n\t\t\t\tpayment_method: 'square_credit_card',\n\t\t\t\tship_to_different_address: 1,\n\t\t\t\tterms: 1,\n\t\t\t\t'wc-square-credit-card-payment-nonce': nonce,\n\t\t\t\t'wc-square-credit-card-last-four': cardData.last_4 ? cardData.last_4 : null,\n\t\t\t\t'wc-square-credit-card-exp-month': cardData.exp_month ? cardData.exp_month : null,\n\t\t\t\t'wc-square-credit-card-exp-year': cardData.exp_year ? cardData.exp_year : null,\n\t\t\t\t'wc-square-credit-card-payment-postcode': cardData.billing_postal_code ? cardData.billing_postal_code : null,\n\t\t\t\t'wc-square-digital-wallet-type': cardData.digital_wallet_type,\n\t\t\t};\n\n\t\t\t// handle slightly different mapping for Google Pay (Google returns full name as a single string).\n\t\t\tif ( cardData.digital_wallet_type === 'GOOGLE_PAY' ) {\n\t\t\t\tif ( billingContact.givenName ) {\n\t\t\t\t\tdata.billing_first_name = billingContact.givenName.split( ' ' ).slice( 0, 1 ).join( ' ' );\n\t\t\t\t\tdata.billing_last_name = billingContact.givenName.split( ' ' ).slice( 1 ).join( ' ' );\n\t\t\t\t}\n\n\t\t\t\tif ( shippingContact.givenName ) {\n\t\t\t\t\tdata.shipping_last_name = shippingContact.givenName.split( ' ' ).slice( 0, 1 ).join( ' ' );\n\t\t\t\t\tdata.shipping_last_name = shippingContact.givenName.split( ' ' ).slice( 1 ).join( ' ' );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// if the billing_phone was not found on shippingContact, use the value on billingContact if that exists.\n\t\t\tif ( ! data.billing_phone && billingContact.phone ) {\n\t\t\t\tdata.billing_phone = billingContact.phone;\n\t\t\t}\n\n\t\t\t// if SCA is enabled, verify the buyer and add verification token to data.\n\t\t\tif ( this.args.is_3d_secure_enabled ) {\n\t\t\t\tthis.log( '3DS verification enabled. Verifying buyer' );\n\n\t\t\t\tvar self = this;\n\n\t\t\t\tthis.payment_form.verifyBuyer(\n\t\t\t\t\tnonce,\n\t\t\t\t\tself.get_verification_details( billingContact, shippingContact ),\n\t\t\t\t\tfunction(err, verificationResult) {\n\t\t\t\t\t\tif (err == null) {\n\t\t\t\t\t\t\t// SCA verification complete. Do checkout.\n\t\t\t\t\t\t\tself.log( '3DS verification successful' );\n\t\t\t\t\t\t\tdata['wc-square-credit-card-buyer-verification-token'] = verificationResult.token;\n\t\t\t\t\t\t\tself.do_checkout( data );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// SCA verification failed. Render errors.\n\t\t\t\t\t\t\tself.log( '3DS verification failed' );\n\t\t\t\t\t\t\tself.log(err);\n\t\t\t\t\t\t\tself.render_errors( [err.message] );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t// SCA not enabled. Do checkout.\n\t\t\t\tthis.do_checkout( data );\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Do Digital Wallet Checkout\n\t\t *\n\t\t * @since 2.4.2\n\t\t *\n\t\t * @param {Object} args\n\t\t */\n\t\tdo_checkout( data ) {\n\t\t\t// AJAX process checkout.\n\t\t\tthis.process_digital_wallet_checkout( data ).then(\n\t\t\t\t( response ) => {\n\t\t\t\t\twindow.location = response.redirect;\n\t\t\t\t},\n\t\t\t\t( response ) => {\n\t\t\t\t\tthis.log( response, 'error' );\n\t\t\t\t\tthis.render_errors_html( response.messages );\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * Gets a verification details object to be used in verifyBuyer()\n\t\t *\n\t\t * @since 2.4.2\n\t\t *\n\t\t * @param {Object} billingContact\n\t\t * @param {Object} shippingContact\n\t\t *\n\t\t * @return {Object} Verification details object.\n\t\t */\n\t\tget_verification_details( billingContact, shippingContact ) {\n\t\t\tconst verification_details = {\n\t\t\t\tintent: 'CHARGE',\n\t\t\t\tamount: this.total_amount,\n\t\t\t\tcurrencyCode: this.payment_request.currencyCode,\n\t\t\t\tbillingContact: {\n\t\t\t\t\tfamilyName: billingContact.familyName ? billingContact.familyName : '',\n\t\t\t\t\tgivenName: billingContact.givenName ? billingContact.givenName : '',\n\t\t\t\t\temail: shippingContact.email ? shippingContact.email : '',\n\t\t\t\t\tcountry: billingContact.country ? billingContact.country.toUpperCase() : '',\n\t\t\t\t\tregion: billingContact.region ? billingContact.region : '',\n\t\t\t\t\tcity: billingContact.city ? billingContact.city : '',\n\t\t\t\t\tpostalCode: billingContact.postalCode ? billingContact.postalCode : '',\n\t\t\t\t\tphone: shippingContact.phone ? shippingContact.phone : '',\n\t\t\t\t\taddressLines: billingContact.addressLines ? billingContact.addressLines : '',\n\t\t\t\t},\n\t\t\t}\n\n\t\t\tthis.log( verification_details );\n\n\t\t\treturn verification_details;\n\t\t}\n\n\t\t/*\n\t\t * Recalculate totals\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\trecalculate_totals( data ) {\n\t\t\treturn new Promise( ( resolve, reject ) => {\n\t\t\t\treturn $.post( this.get_ajax_url( 'recalculate_totals' ), data, ( response ) => {\n\t\t\t\t\tif ( response.success ) {\n\t\t\t\t\t\tthis.total_amount = response.data.total.amount;\n\t\t\t\t\t\treturn resolve( response.data );\n\t\t\t\t\t}\n\t\t\t\t\treturn reject( response.data );\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\n\t\t/*\n\t\t * Get the product data for building the payment request on the product page\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\tget_product_data() {\n\t\t\tlet product_id = $( '.single_add_to_cart_button' ).val();\n\n\t\t\tconst attributes = {};\n\n\t\t\t// Check if product is a variable product.\n\t\t\tif ( $( '.single_variation_wrap' ).length ) {\n\t\t\t\tproduct_id = $( '.single_variation_wrap' ).find( 'input[name=\"product_id\"]' ).val();\n\t\t\t\tif ( $( '.variations_form' ).length ) {\n\t\t\t\t\t$( '.variations_form' ).find( '.variations select' ).each( ( index, select ) => {\n\t\t\t\t\t\tconst attribute_name = $( select ).data( 'attribute_name' ) || $( select ).attr( 'name' );\n\t\t\t\t\t\tconst value = $( select ).val() || '';\n\t\t\t\t\t\treturn attributes[ attribute_name ] = value;\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tproduct_id,\n\t\t\t\tquantity: $( '.quantity .qty' ).val(),\n\t\t\t\tattributes,\n\t\t\t};\n\t\t}\n\n\t\t/*\n\t\t * Add the product to the cart\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\tadd_to_cart() {\n\t\t\tconst data = {\n\t\t\t\tsecurity: this.args.add_to_cart_nonce,\n\t\t\t};\n\t\t\tconst product_data = this.get_product_data();\n\t\t\t$.extend( data, product_data );\n\n\t\t\t// retrieve a payment request object.\n\t\t\t$.post( this.get_ajax_url( 'add_to_cart' ), data, ( response ) => {\n\t\t\t\tif ( response.error ) {\n\t\t\t\t\treturn window.alert( response.data );\n\t\t\t\t}\n\n\t\t\t\tconst data = JSON.parse( response.data );\n\t\t\t\tthis.payment_request = data.payment_request;\n\t\t\t\tthis.args.payment_request_nonce = data.payment_request_nonce;\n\t\t\t\tthis.args.add_to_cart_nonce = data.add_to_cart_nonce;\n\t\t\t\tthis.args.recalculate_totals_nonce = data.recalculate_totals_nonce;\n\t\t\t\tthis.args.process_checkout_nonce = data.process_checkout_nonce;\n\t\t\t} );\n\t\t}\n\n\t\t/*\n\t\t * Process the digital wallet checkout\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\tprocess_digital_wallet_checkout( data ) {\n\t\t\treturn new Promise( ( resolve, reject ) => {\n\t\t\t\t$.post( this.get_ajax_url( 'process_checkout' ), data, ( response ) => {\n\t\t\t\t\tif ( response.result === 'success' ) {\n\t\t\t\t\t\treturn resolve( response );\n\t\t\t\t\t}\n\n\t\t\t\t\treturn reject( response );\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\n\t\t/*\n\t\t * Helper function to return the ajax URL for the given request/action\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\tget_ajax_url( request ) {\n\t\t\treturn this.args.ajax_url.replace( '%%endpoint%%', 'square_digital_wallet_' + request );\n\t\t}\n\n\t\t/*\n\t\t * Renders errors given the error message HTML\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\trender_errors_html( errors_html ) {\n\t\t\t// hide and remove any previous errors.\n\t\t\t$( '.woocommerce-error, .woocommerce-message' ).remove();\n\n\t\t\tconst element = this.args.context === 'product' ? $( '.product' ) : $( '.shop_table.cart' ).closest( 'form' );\n\n\t\t\t// add errors\n\t\t\telement.before( errors_html );\n\n\t\t\t// unblock UI\n\t\t\tthis.unblock_ui();\n\n\t\t\t// scroll to top\n\t\t\t$( 'html, body' ).animate( {\n\t\t\t\tscrollTop: element.offset().top - 100,\n\t\t\t}, 1000 );\n\t\t}\n\n\t\t/*\n\t\t * Renders errors\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\trender_errors( errors ) {\n\t\t\tconst error_message_html = '<ul class=\"woocommerce-error\"><li>' + errors.join( '</li><li>' ) + '</li></ul>';\n\t\t\tthis.render_errors_html( error_message_html );\n\t\t}\n\n\t\t/*\n\t\t * Block the Apple Pay and Google Pay buttons from being clicked which processing certain actions\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\tblock_ui() {\n\t\t\t$( this.buttons ).block( {\n\t\t\t\tmessage: null,\n\t\t\t\toverlayCSS: {\n\t\t\t\t\tbackground: '#fff',\n\t\t\t\t\topacity: 0.6,\n\t\t\t\t},\n\t\t\t} );\n\t\t}\n\n\t\t/*\n\t\t * Unblock the wallet buttons\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\tunblock_ui() {\n\t\t\t$( this.buttons ).unblock();\n\t\t}\n\n\t\t/*\n\t\t * Logs messages to the console when logging is turned on in the settings\n\t\t *\n\t\t * @since 2.3\n\t\t */\n\t\tlog( message, type = 'notice' ) {\n\t\t\t// if logging is disabled, bail.\n\t\t\tif ( ! this.args.logging_enabled ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( type === 'error' ) {\n\t\t\t\treturn console.error( message );\n\t\t\t}\n\n\t\t\treturn console.log( message );\n\t\t}\n\t}\n\n\twindow.WC_Square_Digital_Wallet_Handler = WC_Square_Digital_Wallet_Handler;\n} );\n"],"file":"wc-square-digital-wallet.min.js"}